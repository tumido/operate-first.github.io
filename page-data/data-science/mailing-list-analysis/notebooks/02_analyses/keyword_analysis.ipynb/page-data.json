{"componentChunkName":"component---src-templates-jupyter-notebook-js","path":"/data-science/mailing-list-analysis/notebooks/02_analyses/keyword_analysis.ipynb","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"jupyterNotebook":{"id":"bc625aff-b2bd-55ba-8443-513464fac5fe >>> JupyterNotebook","html":"<div class=\"notebook-render\"><div class=\"sc-ifAKCX zMCZx\"><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h1>Monthly Keyword Analysis</h1>\n<p>This notebook ingests the preprocessed data from <code>../interim/text</code> downloaded by <code>download_datasets.ipynb</code> and uses a TF-IDF method to identify the top 10 keywords for each month. This is done by implementing the following procedure: For each month, we train and fit a separate TF-IDF model, then collect the top 10 scoring words for each email and sum their occurrences to identify the top 10 most frequently occurring keywords for each month.     </p>\n<p>Finally, the data is saved as a single csv file and pushed to remote storage for visualization with Superset. </p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[1]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">import</span> pandas <span class=\"token\" style=\"color:#0000ff\">as</span> pd\n<span class=\"token\" style=\"color:#0000ff\">import</span> numpy <span class=\"token\" style=\"color:#0000ff\">as</span> np\n<span class=\"token\" style=\"color:#0000ff\">import</span> os\n<span class=\"token\" style=\"color:#0000ff\">import</span> datetime\n<span class=\"token\" style=\"color:#0000ff\">import</span> re\n<span class=\"token\" style=\"color:#0000ff\">from</span> sklearn<span class=\"token\" style=\"color:#393A34\">.</span>feature_extraction<span class=\"token\" style=\"color:#393A34\">.</span>text <span class=\"token\" style=\"color:#0000ff\">import</span> TfidfVectorizer\n<span class=\"token\" style=\"color:#0000ff\">from</span> collections <span class=\"token\" style=\"color:#0000ff\">import</span> Counter\n<span class=\"token\" style=\"color:#0000ff\">import</span> gc\n\n\n<span class=\"token\" style=\"color:#0000ff\">from</span> pathlib <span class=\"token\" style=\"color:#0000ff\">import</span> Path\n\n<span class=\"token\" style=\"color:#0000ff\">from</span> dotenv <span class=\"token\" style=\"color:#0000ff\">import</span> load_dotenv\n\nload_dotenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;../../.env&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">import</span> sys\n\nsys<span class=\"token\" style=\"color:#393A34\">.</span>path<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;../..&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">from</span> src <span class=\"token\" style=\"color:#0000ff\">import</span> utils</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[2]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">BASE_PATH <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;LOCAL_DATA_PATH&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;../../data&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\nLAST_MONTH_DATE <span class=\"token\" style=\"color:#393A34\">=</span> datetime<span class=\"token\" style=\"color:#393A34\">.</span>datetime<span class=\"token\" style=\"color:#393A34\">.</span>now<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span>day<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">-</span> datetime<span class=\"token\" style=\"color:#393A34\">.</span>timedelta<span class=\"token\" style=\"color:#393A34\">(</span>\n    days<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span>\n<span class=\"token\" style=\"color:#393A34\">)</span>\nyear <span class=\"token\" style=\"color:#393A34\">=</span> LAST_MONTH_DATE<span class=\"token\" style=\"color:#393A34\">.</span>year\nmonth <span class=\"token\" style=\"color:#393A34\">=</span> LAST_MONTH_DATE<span class=\"token\" style=\"color:#393A34\">.</span>month</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[3]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">if</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;RUN_IN_AUTOMATION&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    df <span class=\"token\" style=\"color:#393A34\">=</span> pd<span class=\"token\" style=\"color:#393A34\">.</span>read_csv<span class=\"token\" style=\"color:#393A34\">(</span>\n        <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>BASE_PATH<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">/interim/text/fedora-devel-</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>year<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">-</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>month<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">.mbox.csv&quot;</span></span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n    df<span class=\"token\" style=\"color:#393A34\">.</span>head<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    df <span class=\"token\" style=\"color:#393A34\">=</span> utils<span class=\"token\" style=\"color:#393A34\">.</span>load_dataset<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>BASE_PATH<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">/interim/text/&quot;</span></span><span class=\"token\" style=\"color:#393A34\">)</span>\n    df<span class=\"token\" style=\"color:#393A34\">.</span>head<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[4]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">df<span class=\"token\" style=\"color:#393A34\">.</span>shape</code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>(41997, 3)</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Text Preprocessing</h2>\n<p>Due to the casual nature of email writing, along with some known useless artifacts present in our textual dataset, we need to clean our data a bit before performing our analysis. </p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[5]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">strip_thread</span><span class=\"token\" style=\"color:#393A34\">(</span>text<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    text <span class=\"token\" style=\"color:#393A34\">=</span> text<span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;\\r&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> text<span class=\"token\" style=\"color:#393A34\">.</span>split<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;\\n&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>line<span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">&gt;</span> <span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;&gt;&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">3</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Re:&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">7</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Subject&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">5</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;From:&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">5</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Date:&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#A31515\">&quot;BEGIN PGP SIGNED MESSAGE&quot;</span> <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#0000ff\">in</span> line<span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">5</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Hash:&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">10</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Version: G&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#A31515\">&quot;wrote:&quot;</span> <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#0000ff\">in</span> line<span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#A31515\">&quot;wrote :&quot;</span> <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#0000ff\">in</span> line<span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#A31515\">&quot;writes:&quot;</span> <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#0000ff\">in</span> line<span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">7</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Am Mit,&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">7</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Am Don,&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">7</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Am Mon,&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">7</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Quoting&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">10</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Em Quinta,&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#A31515\">&quot;said:&quot;</span> <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#0000ff\">in</span> line<span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>\n        line\n        <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines\n        <span class=\"token\" style=\"color:#0000ff\">if</span> re<span class=\"token\" style=\"color:#393A34\">.</span>match<span class=\"token\" style=\"color:#393A34\">(</span>\n            <span class=\"token\" style=\"color:#A31515\">&quot;.*n (Sun|Mon|Tue|Wed|Thu|Fri|Sat), .. (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Sept|Oct|Nov|Dec) 20..*&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n            line<span class=\"token\" style=\"color:#393A34\">,</span>\n        <span class=\"token\" style=\"color:#393A34\">)</span>\n        <span class=\"token\" style=\"color:#0000ff\">is</span> <span class=\"token\" style=\"color:#36acaa\">None</span>\n    <span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>\n        line\n        <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines\n        <span class=\"token\" style=\"color:#0000ff\">if</span> re<span class=\"token\" style=\"color:#393A34\">.</span>match<span class=\"token\" style=\"color:#393A34\">(</span>\n            <span class=\"token\" style=\"color:#393A34\">(</span>\n                <span class=\"token\" style=\"color:#A31515\">&quot;.*n (Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday) ..&quot;</span>\n                <span class=\"token\" style=\"color:#A31515\">&quot; (January|February|March|April|May|June|July|August|September|October|November|December) 20..*&quot;</span>\n            <span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span>\n            line<span class=\"token\" style=\"color:#393A34\">,</span>\n        <span class=\"token\" style=\"color:#393A34\">)</span>\n        <span class=\"token\" style=\"color:#0000ff\">is</span> <span class=\"token\" style=\"color:#36acaa\">None</span>\n    <span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>\n        line\n        <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines\n        <span class=\"token\" style=\"color:#0000ff\">if</span> re<span class=\"token\" style=\"color:#393A34\">.</span>match<span class=\"token\" style=\"color:#393A34\">(</span>\n            <span class=\"token\" style=\"color:#A31515\">&quot;.*n (Sun|Mon|Tue|Wed|Thu|Fri|Sat), (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Sept|Oct|Nov|Dec) .., 20..*&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n            line<span class=\"token\" style=\"color:#393A34\">,</span>\n        <span class=\"token\" style=\"color:#393A34\">)</span>\n        <span class=\"token\" style=\"color:#0000ff\">is</span> <span class=\"token\" style=\"color:#36acaa\">None</span>\n    <span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>\n        line\n        <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines\n        <span class=\"token\" style=\"color:#0000ff\">if</span> re<span class=\"token\" style=\"color:#393A34\">.</span>match<span class=\"token\" style=\"color:#393A34\">(</span>\n            <span class=\"token\" style=\"color:#A31515\">r&quot;.*n (Sun|Mon|Tue|Wed|Thu|Fri|Sat), 20[\\d]{2}-[\\d]{2}-[\\d]{2} at.*&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n            line<span class=\"token\" style=\"color:#393A34\">,</span>\n        <span class=\"token\" style=\"color:#393A34\">)</span>\n        <span class=\"token\" style=\"color:#0000ff\">is</span> <span class=\"token\" style=\"color:#36acaa\">None</span>\n    <span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">-</span><span class=\"token\" style=\"color:#36acaa\">6</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;said: &quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">-</span><span class=\"token\" style=\"color:#36acaa\">8</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;babbled:&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">-</span><span class=\"token\" style=\"color:#36acaa\">7</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;wrot=e:&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">-</span><span class=\"token\" style=\"color:#36acaa\">8</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;A9crit :&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;|&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    <span class=\"token\" style=\"color:#0000ff\">return</span> <span class=\"token\" style=\"color:#A31515\">&quot;\\n&quot;</span><span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span>lines<span class=\"token\" style=\"color:#393A34\">)</span>\n\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># format for CSV, clean special characters, and remove extranous emails</span>\n<span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">pandas_clean</span><span class=\"token\" style=\"color:#393A34\">(</span>emails<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span>\n        to_replace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span>\n            <span class=\"token\" style=\"color:#A31515\">r&quot;\\n&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n            <span class=\"token\" style=\"color:#A31515\">&quot;\\n&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n        <span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span>\n        value<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot; &quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n        regex<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span>\n        inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span>\n        to_replace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">r&quot;\\&#x27;&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;&#x27;&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;&gt;&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;&lt;&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;= &quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;-&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">r&quot;http\\S+&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span>\n        value<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n        regex<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span>\n        inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span>\n        to_replace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">r&quot;\\\\\\s+&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">r&quot;\\\\s+&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;=&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> value<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> regex<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span>\n        to_replace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;   &quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;  &quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> value<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot; &quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> regex<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span>\n        to_replace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;_&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;3D&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> value<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> regex<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span>\n        to_replace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;   &quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;  &quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> value<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot; &quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> regex<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span>\n        to_replace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;   &quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;  &quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> value<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot; &quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> regex<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">apply</span><span class=\"token\" style=\"color:#393A34\">(</span>\n        <span class=\"token\" style=\"color:#0000ff\">lambda</span> x<span class=\"token\" style=\"color:#393A34\">:</span> x<span class=\"token\" style=\"color:#393A34\">.</span>strip<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">r&quot;\\n&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n\n    emails<span class=\"token\" style=\"color:#393A34\">.</span>drop<span class=\"token\" style=\"color:#393A34\">(</span>emails<span class=\"token\" style=\"color:#393A34\">.</span>index<span class=\"token\" style=\"color:#393A34\">[</span>emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">==</span> <span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">.</span>drop<span class=\"token\" style=\"color:#393A34\">(</span>emails<span class=\"token\" style=\"color:#393A34\">.</span>index<span class=\"token\" style=\"color:#393A34\">[</span>emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">==</span> <span class=\"token\" style=\"color:#A31515\">&quot; &quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">.</span>dropna<span class=\"token\" style=\"color:#393A34\">(</span>subset<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n    emails <span class=\"token\" style=\"color:#393A34\">=</span> emails<span class=\"token\" style=\"color:#393A34\">.</span>reset_index<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">.</span>drop<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;index&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">return</span> emails</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[6]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">clean <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">.</span>copy<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\nclean<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> clean<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">apply</span><span class=\"token\" style=\"color:#393A34\">(</span>strip_thread<span class=\"token\" style=\"color:#393A34\">)</span>\nclean <span class=\"token\" style=\"color:#393A34\">=</span> pandas_clean<span class=\"token\" style=\"color:#393A34\">(</span>clean<span class=\"token\" style=\"color:#393A34\">)</span>\nclean</code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Message-ID</th>\n      <th>Date</th>\n      <th>Body</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>&lt;1519862707.18745.0@posteo.de&gt;</td>\n      <td>Wed, 28 Feb 2018 18:05:07 -0600</td>\n      <td>[I have an update here: is blocked due to some...</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>&lt;1519885501.29070.9.camel@fedoraproject.org&gt;</td>\n      <td>Thu, 01 Mar 2018 01:25:01 -0500</td>\n      <td>[\"C2A0Following is the list of topics that wil...</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>&lt;1519886671.29070.13.camel@fedoraproject.org&gt;</td>\n      <td>Thu, 01 Mar 2018 01:44:31 -0500</td>\n      <td>[\"C2A0The Fedora Packaging Committee has some ...</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>&lt;1519888291.16369.3.camel@fedoraproject.org&gt;</td>\n      <td>Thu, 01 Mar 2018 02:11:31 -0500</td>\n      <td>[\"C2A0The Fedora Packaging Committee has some ...</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>&lt;20180301103525.22531.58685@mailman01.phx2.fed...</td>\n      <td>Thu, 01 Mar 2018 10:35:25 +0000</td>\n      <td>[Hi,when compiling qarte4.4.0 with this spec f...</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>13862</th>\n      <td>&lt;20190630045144.22906.88878@mailman01.phx2.fed...</td>\n      <td>Sun, 30 Jun 2019 04:51:44 +0000</td>\n      <td>[\"speedtestcli and python3speedtestcli appear ...</td>\n    </tr>\n    <tr>\n      <th>13863</th>\n      <td>&lt;c94d58e2-e218-8f69-0ff2-a46cd57ab65b@redhat.com&gt;</td>\n      <td>Sun, 30 Jun 2019 11:46:31 +0200</td>\n      <td>[Hey,pip and Python packages generally deem 5....</td>\n    </tr>\n    <tr>\n      <th>13864</th>\n      <td>&lt;ee3d5633-fd1b-7f71-e173-788c61c9a9e3@gmail.com&gt;</td>\n      <td>Sun, 30 Jun 2019 05:21:47 -0500</td>\n      <td>[\"Hi,Does Fedora Silverblue Rawhide not suppor...</td>\n    </tr>\n    <tr>\n      <th>13865</th>\n      <td>&lt;ee5805d4ea36e9b22893b21d2cf41bfda2db6dca.came...</td>\n      <td>Sun, 30 Jun 2019 08:51:21 -0700</td>\n      <td>[\"Hi folks! Im proposing we cancel the QA meet...</td>\n    </tr>\n    <tr>\n      <th>13866</th>\n      <td>&lt;66883937-a249-059a-fff0-161eeddc6db6@redhat.com&gt;</td>\n      <td>Sun, 30 Jun 2019 23:51:57 +0200</td>\n      <td>[Hi All,The work I\\ve been doing to improve su...</td>\n    </tr>\n  </tbody>\n</table>\n<p>13867 rows  3 columns</p>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[7]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">clean<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Date&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> clean<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Date&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">apply</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#0000ff\">lambda</span> x<span class=\"token\" style=\"color:#393A34\">:</span> pd<span class=\"token\" style=\"color:#393A34\">.</span>to_datetime<span class=\"token\" style=\"color:#393A34\">(</span>x<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\nclean<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Chunk&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> clean<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Date&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">apply</span><span class=\"token\" style=\"color:#393A34\">(</span>\n    <span class=\"token\" style=\"color:#0000ff\">lambda</span> x<span class=\"token\" style=\"color:#393A34\">:</span> datetime<span class=\"token\" style=\"color:#393A34\">.</span>date<span class=\"token\" style=\"color:#393A34\">(</span>x<span class=\"token\" style=\"color:#393A34\">.</span>year<span class=\"token\" style=\"color:#393A34\">,</span> x<span class=\"token\" style=\"color:#393A34\">.</span>month<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#393A34\">)</span>\nclean <span class=\"token\" style=\"color:#393A34\">=</span> clean<span class=\"token\" style=\"color:#393A34\">.</span>sort_values<span class=\"token\" style=\"color:#393A34\">(</span>by<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;Date&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nclean<span class=\"token\" style=\"color:#393A34\">.</span>reset_index<span class=\"token\" style=\"color:#393A34\">(</span>inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span> drop<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\nclean<span class=\"token\" style=\"color:#393A34\">.</span>head<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Message-ID</th>\n      <th>Date</th>\n      <th>Body</th>\n      <th>Chunk</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>&lt;20180101220004.0E97560A400C@fedocal02.phx2.fe...</td>\n      <td>2018-01-01 22:00:04+00:00</td>\n      <td>[Dear all,You are kindly invited to the meetin...</td>\n      <td>2018-01-01</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>&lt;20180101220004.0632660A400B@fedocal02.phx2.fe...</td>\n      <td>2018-01-01 22:00:04+00:00</td>\n      <td>[Dear all,You are kindly invited to the meetin...</td>\n      <td>2018-01-01</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>&lt;20180101221314.GA52721@rawhide-composer.phx2....</td>\n      <td>2018-01-01 22:13:15+00:00</td>\n      <td>[OLD: FedoraRawhide20171231.n.0NEW: FedoraRawh...</td>\n      <td>2018-01-01</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>&lt;20180101233509.D734E60478E3@bastion01.phx2.fe...</td>\n      <td>2018-01-01 23:35:09+00:00</td>\n      <td>[Missing expected images:Server dvd i386Workst...</td>\n      <td>2018-01-01</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>&lt;66075732-52f6-2eb8-de1b-d89ec18244db@redhat.com&gt;</td>\n      <td>2018-01-02 10:26:51+01:00</td>\n      <td>[\"Could you please drop the dependency on GCC ...</td>\n      <td>2018-01-01</td>\n    </tr>\n  </tbody>\n</table>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[8]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">clean<span class=\"token\" style=\"color:#393A34\">.</span>tail<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Message-ID</th>\n      <th>Date</th>\n      <th>Body</th>\n      <th>Chunk</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>13862</th>\n      <td>&lt;20201130211635.21006.77071@mailman01.iad2.fed...</td>\n      <td>2020-11-30 21:16:35+00:00</td>\n      <td>[Hello. I want to buy myself Dell XPS 13 9310 ...</td>\n      <td>2020-11-01</td>\n    </tr>\n    <tr>\n      <th>13863</th>\n      <td>&lt;28998e59-9857-8c3d-548f-47d6642d3789@redhat.com&gt;</td>\n      <td>2020-11-30 23:00:32+01:00</td>\n      <td>[Hi guys,not sure whether I missed something, ...</td>\n      <td>2020-11-01</td>\n    </tr>\n    <tr>\n      <th>13864</th>\n      <td>&lt;e1fcf02c-43d0-00e1-6b6a-0eed22468ca0@redhat.com&gt;</td>\n      <td>2020-11-30 14:06:04-08:00</td>\n      <td>[Hi,As part of the f34 change request[1] for r...</td>\n      <td>2020-11-01</td>\n    </tr>\n    <tr>\n      <th>13865</th>\n      <td>&lt;637e6814-bc05-4713-6226-7192a437df46@redhat.com&gt;</td>\n      <td>2020-11-30 23:23:18+01:00</td>\n      <td>[Dne 30. 11. 20 v 19:29 Rudolf Kastl napsal(a)...</td>\n      <td>2020-11-01</td>\n    </tr>\n    <tr>\n      <th>13866</th>\n      <td>&lt;1fb0c88e-79fa-ce05-8c77-5a0e8c95a0a8@redhat.com&gt;</td>\n      <td>2020-11-30 23:31:39+01:00</td>\n      <td>[Dne 30. 11. 20 v 23:06 Tom Stellard napsal(a)...</td>\n      <td>2020-11-01</td>\n    </tr>\n  </tbody>\n</table>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Single month example</h2>\n<p>Here we will prototype our method for identifying top N key words for a single month, to ensure it works properly before applying it to the entire dataset. </p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[9]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#0000ff\">not</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;RUN_IN_AUTOMATION&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    corpus <span class=\"token\" style=\"color:#393A34\">=</span> clean<span class=\"token\" style=\"color:#393A34\">[</span>clean<span class=\"token\" style=\"color:#393A34\">.</span>Chunk <span class=\"token\" style=\"color:#393A34\">==</span> datetime<span class=\"token\" style=\"color:#393A34\">.</span>date<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#36acaa\">2020</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">11</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>Body\n    vectorizer <span class=\"token\" style=\"color:#393A34\">=</span> TfidfVectorizer<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    X <span class=\"token\" style=\"color:#393A34\">=</span> vectorizer<span class=\"token\" style=\"color:#393A34\">.</span>fit_transform<span class=\"token\" style=\"color:#393A34\">(</span>corpus<span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>X<span class=\"token\" style=\"color:#393A34\">.</span>shape<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>(440, 37733)\n</span></code></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[10]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#0000ff\">not</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;RUN_IN_AUTOMATION&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    feature_array <span class=\"token\" style=\"color:#393A34\">=</span> np<span class=\"token\" style=\"color:#393A34\">.</span>array<span class=\"token\" style=\"color:#393A34\">(</span>vectorizer<span class=\"token\" style=\"color:#393A34\">.</span>get_feature_names<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n    Document <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    <span class=\"token\" style=\"color:#0000ff\">for</span> i<span class=\"token\" style=\"color:#393A34\">,</span> j <span class=\"token\" style=\"color:#0000ff\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token\" style=\"color:#393A34\">(</span>X<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>toarray<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        <span class=\"token\" style=\"color:#0000ff\">if</span> j <span class=\"token\" style=\"color:#393A34\">&gt;</span> <span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">:</span>\n            Document<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">(</span>i<span class=\"token\" style=\"color:#393A34\">,</span> j<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n    top_10 <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token builtin\">sorted</span><span class=\"token\" style=\"color:#393A34\">(</span>Document<span class=\"token\" style=\"color:#393A34\">,</span> key<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#0000ff\">lambda</span> x<span class=\"token\" style=\"color:#393A34\">:</span> x<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> reverse<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">10</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    top_10_keys <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>x<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#0000ff\">for</span> x <span class=\"token\" style=\"color:#0000ff\">in</span> top_10<span class=\"token\" style=\"color:#393A34\">]</span>\n    <span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">[</span>feature_array<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#0000ff\">for</span> i <span class=\"token\" style=\"color:#0000ff\">in</span> top_10_keys<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> end<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;\\n\\n&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>corpus<span class=\"token\" style=\"color:#393A34\">[</span>corpus<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>index<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">del</span> feature_array\n    gc<span class=\"token\" style=\"color:#393A34\">.</span>collect<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>[&#x27;cloudbaseqcow2qcow2&#x27;, &#x27;ttest&#x27;, &#x27;aarch64&#x27;, &#x27;x8664&#x27;, &#x27;uefiurl&#x27;, &#x27;fedoracloud3320201031&#x27;, &#x27;soft&#x27;, &#x27;712248&#x27;, &#x27;712249&#x27;, &#x27;712250&#x27;]\n\n[No missing expected images.Soft failed openQA tests: 1/7 (x8664), 1/7 (aarch64)(Tests completed, but using a workaround for a known bug)Old soft failures (same test soft failed in FedoraCloud3320201031.0):ID: 712253\\tTest: x8664 CloudBaseqcow2qcow2 cloudautocloudURL: 712261\\tTest: aarch64 CloudBaseqcow2qcow2 cloudautocloud(a)uefiURL: openQA tests: 6/7 (x8664), 6/7 (aarch64)New passes (same test not passed in FedoraCloud3320201031.0):ID: 712248\\tTest: x8664 CloudBaseqcow2qcow2 baserebootunmountURL: 712249\\tTest: x8664 CloudBaseqcow2qcow2 basesystemloggingURL: 712250\\tTest: x8664 CloudBaseqcow2qcow2 baseupdatecliURL: 712251\\tTest: x8664 CloudBaseqcow2qcow2 baseservicemanipulationURL: 712252\\tTest: x8664 CloudBaseqcow2qcow2 baseservicesstartURL: 712254\\tTest: x8664 CloudBaseqcow2qcow2 baseselinuxURL: 712255\\tTest: aarch64 CloudBaseqcow2qcow2 basesystemlogging(a)uefiURL: 712256\\tTest: aarch64 CloudBaseqcow2qcow2 baserebootunmount(a)uefiURL: 712257\\tTest: aarch64 CloudBaseqcow2qcow2 baseservicesstart(a)uefiURL: 712258\\tTest: aarch64 CloudBaseqcow2qcow2 baseupdatecli(a)uefiURL: 712259\\tTest: aarch64 CloudBaseqcow2qcow2 baseservicemanipulation(a)uefiURL: 712260\\tTest: aarch64 CloudBaseqcow2qcow2 baseselinux(a)uefiURL: Mail generated by checkcompose:\n</span></code></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>Looks out key words are reasonable given the email in question above.   </p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h3>Run full analysis on entire dataset</h3>\n<p>Now that we are confident our approach works, we will break it up into manageable functions and apply it to each months dataset. </p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[11]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">train_monthly_tfidf</span><span class=\"token\" style=\"color:#393A34\">(</span>corpus<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    vectorizer <span class=\"token\" style=\"color:#393A34\">=</span> TfidfVectorizer<span class=\"token\" style=\"color:#393A34\">(</span>stop_words<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;english&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    x <span class=\"token\" style=\"color:#393A34\">=</span> vectorizer<span class=\"token\" style=\"color:#393A34\">.</span>fit_transform<span class=\"token\" style=\"color:#393A34\">(</span>corpus<span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">return</span> x<span class=\"token\" style=\"color:#393A34\">,</span> vectorizer\n\n\n<span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">top_words_per_email</span><span class=\"token\" style=\"color:#393A34\">(</span>email_vector<span class=\"token\" style=\"color:#393A34\">,</span> feature_array<span class=\"token\" style=\"color:#393A34\">,</span> top_words<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">10</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    document <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    <span class=\"token\" style=\"color:#0000ff\">for</span> i<span class=\"token\" style=\"color:#393A34\">,</span> j <span class=\"token\" style=\"color:#0000ff\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token\" style=\"color:#393A34\">(</span>email_vector<span class=\"token\" style=\"color:#393A34\">.</span>toarray<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        <span class=\"token\" style=\"color:#0000ff\">if</span> j <span class=\"token\" style=\"color:#393A34\">&gt;</span> <span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">:</span>\n            document<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">(</span>i<span class=\"token\" style=\"color:#393A34\">,</span> j<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    top_n <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token builtin\">sorted</span><span class=\"token\" style=\"color:#393A34\">(</span>document<span class=\"token\" style=\"color:#393A34\">,</span> key<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#0000ff\">lambda</span> x<span class=\"token\" style=\"color:#393A34\">:</span> x<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> reverse<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">:</span>top_words<span class=\"token\" style=\"color:#393A34\">]</span>\n    top_n_keys <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>x<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#0000ff\">for</span> x <span class=\"token\" style=\"color:#0000ff\">in</span> top_n<span class=\"token\" style=\"color:#393A34\">]</span>\n    top_n_words <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>feature_array<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#0000ff\">for</span> i <span class=\"token\" style=\"color:#0000ff\">in</span> top_n_keys<span class=\"token\" style=\"color:#393A34\">]</span>\n    <span class=\"token\" style=\"color:#0000ff\">return</span> top_n_words\n\n\n<span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">get_monthly_keywords</span><span class=\"token\" style=\"color:#393A34\">(</span>corpus<span class=\"token\" style=\"color:#393A34\">,</span> chunk<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    x<span class=\"token\" style=\"color:#393A34\">,</span> vectorizer <span class=\"token\" style=\"color:#393A34\">=</span> train_monthly_tfidf<span class=\"token\" style=\"color:#393A34\">(</span>corpus<span class=\"token\" style=\"color:#393A34\">)</span>\n    feature_array <span class=\"token\" style=\"color:#393A34\">=</span> np<span class=\"token\" style=\"color:#393A34\">.</span>array<span class=\"token\" style=\"color:#393A34\">(</span>vectorizer<span class=\"token\" style=\"color:#393A34\">.</span>get_feature_names<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    keywords <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    <span class=\"token\" style=\"color:#0000ff\">for</span> i <span class=\"token\" style=\"color:#0000ff\">in</span> <span class=\"token builtin\">range</span><span class=\"token\" style=\"color:#393A34\">(</span>x<span class=\"token\" style=\"color:#393A34\">.</span>shape<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        keywords<span class=\"token\" style=\"color:#393A34\">.</span>extend<span class=\"token\" style=\"color:#393A34\">(</span>top_words_per_email<span class=\"token\" style=\"color:#393A34\">(</span>x<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> feature_array<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n    keywords <span class=\"token\" style=\"color:#393A34\">=</span> Counter<span class=\"token\" style=\"color:#393A34\">(</span>keywords<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>most_common<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#36acaa\">10</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    keywords <span class=\"token\" style=\"color:#393A34\">=</span> pd<span class=\"token\" style=\"color:#393A34\">.</span>DataFrame<span class=\"token\" style=\"color:#393A34\">(</span>keywords<span class=\"token\" style=\"color:#393A34\">,</span> columns<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;word&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;count&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    keywords<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;month&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> chunk\n    <span class=\"token\" style=\"color:#0000ff\">del</span> feature_array\n    gc<span class=\"token\" style=\"color:#393A34\">.</span>collect<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n    <span class=\"token\" style=\"color:#0000ff\">return</span> keywords</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[12]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">dataset_base_path <span class=\"token\" style=\"color:#393A34\">=</span> Path<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>BASE_PATH<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">/processed/keywords/&quot;</span></span><span class=\"token\" style=\"color:#393A34\">)</span>\ndataset_base_path<span class=\"token\" style=\"color:#393A34\">.</span>mkdir<span class=\"token\" style=\"color:#393A34\">(</span>parents<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span> exist_ok<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[13]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># For each document collect the top 10 words, then sum the top 10 for each month.</span>\n\nmonths <span class=\"token\" style=\"color:#393A34\">=</span> clean<span class=\"token\" style=\"color:#393A34\">.</span>Chunk<span class=\"token\" style=\"color:#393A34\">.</span>unique<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\nnew_files <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">]</span>\n\n<span class=\"token\" style=\"color:#0000ff\">for</span> month <span class=\"token\" style=\"color:#0000ff\">in</span> months<span class=\"token\" style=\"color:#393A34\">:</span>\n    corpus <span class=\"token\" style=\"color:#393A34\">=</span> clean<span class=\"token\" style=\"color:#393A34\">[</span>clean<span class=\"token\" style=\"color:#393A34\">.</span>Chunk <span class=\"token\" style=\"color:#393A34\">==</span> month<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>Body\n    monthly_keywords <span class=\"token\" style=\"color:#393A34\">=</span> get_monthly_keywords<span class=\"token\" style=\"color:#393A34\">(</span>corpus<span class=\"token\" style=\"color:#393A34\">,</span> month<span class=\"token\" style=\"color:#393A34\">)</span>\n    monthly_keywords <span class=\"token\" style=\"color:#393A34\">=</span> monthly_keywords<span class=\"token\" style=\"color:#393A34\">.</span>reset_index<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>set_index<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;word&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    monthly_keywords <span class=\"token\" style=\"color:#393A34\">=</span> monthly_keywords<span class=\"token\" style=\"color:#393A34\">.</span>drop<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;index&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    monthly_keywords<span class=\"token\" style=\"color:#393A34\">.</span>to_csv<span class=\"token\" style=\"color:#393A34\">(</span>\n        <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>BASE_PATH<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">/processed/keywords/keywords-</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>month<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">.csv&quot;</span></span><span class=\"token\" style=\"color:#393A34\">,</span> header<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">False</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n    new_files<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>BASE_PATH<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">/processed/keywords/keywords-</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>month<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">.csv&quot;</span></span><span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>month<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>2018-01-01\n2018-02-01\n2018-03-01\n2018-04-01\n2018-05-01\n2018-06-01\n2018-07-01\n2018-08-01\n2018-09-01\n2018-10-01\n2018-11-01\n2018-12-01\n2019-01-01\n2019-02-01\n2019-03-01\n2019-04-01\n2019-05-01\n2019-06-01\n2019-07-01\n2019-08-01\n2019-09-01\n2019-10-01\n2019-11-01\n2019-12-01\n2020-01-01\n2020-02-01\n2020-03-01\n2020-04-01\n2020-05-01\n2020-06-01\n2020-07-01\n2020-08-01\n2020-09-01\n2020-10-01\n2020-11-01\n</span></code></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[14]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">monthly_keywords</code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>count</th>\n      <th>month</th>\n    </tr>\n    <tr>\n      <th>word</th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>aarch64</th>\n      <td>116</td>\n      <td>2020-11-01</td>\n    </tr>\n    <tr>\n      <th>x8664</th>\n      <td>115</td>\n      <td>2020-11-01</td>\n    </tr>\n    <tr>\n      <th>ttest</th>\n      <td>94</td>\n      <td>2020-11-01</td>\n    </tr>\n    <tr>\n      <th>tests</th>\n      <td>77</td>\n      <td>2020-11-01</td>\n    </tr>\n    <tr>\n      <th>failed</th>\n      <td>64</td>\n      <td>2020-11-01</td>\n    </tr>\n    <tr>\n      <th>cloudbaseqcow2qcow2</th>\n      <td>56</td>\n      <td>2020-11-01</td>\n    </tr>\n    <tr>\n      <th>soft</th>\n      <td>55</td>\n      <td>2020-11-01</td>\n    </tr>\n    <tr>\n      <th>test</th>\n      <td>39</td>\n      <td>2020-11-01</td>\n    </tr>\n    <tr>\n      <th>uefiurl</th>\n      <td>36</td>\n      <td>2020-11-01</td>\n    </tr>\n    <tr>\n      <th>package</th>\n      <td>31</td>\n      <td>2020-11-01</td>\n    </tr>\n  </tbody>\n</table>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Upload results to S3</h2></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[15]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">if</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;RUN_IN_AUTOMATION&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    utils<span class=\"token\" style=\"color:#393A34\">.</span>upload_files<span class=\"token\" style=\"color:#393A34\">(</span>\n        <span class=\"token\" style=\"color:#393A34\">(</span>f<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;processed/keywords/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>Path<span class=\"token\" style=\"color:#393A34\">(</span>f<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>stem<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">.csv&quot;</span></span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#0000ff\">for</span> f <span class=\"token\" style=\"color:#0000ff\">in</span> new_files\n    <span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div></div></div>","fields":{"srcLink":"https://github.com/aicoe-aiops/mailing-list-analysis-toolkit/blob/master/notebooks/02_analyses/keyword_analysis.ipynb"}}},"pageContext":{"id":"bc625aff-b2bd-55ba-8443-513464fac5fe >>> JupyterNotebook"}},"staticQueryHashes":["117426894","3000541721"]}