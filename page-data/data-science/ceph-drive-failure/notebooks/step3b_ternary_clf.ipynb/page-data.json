{"componentChunkName":"component---src-templates-jupyter-notebook-js","path":"/data-science/ceph-drive-failure/notebooks/step3b_ternary_clf.ipynb","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"jupyterNotebook":{"id":"70c576d9-0c33-5452-b94d-2381c6774f9e >>> JupyterNotebook","html":"<div class=\"notebook-render\"><div class=\"sc-ifAKCX zMCZx\"><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h1>Multiclass Classification</h1>\n<p>An intermediate solution beween regression and classification is classifying in chunks (i.e. good, medium, bad)</p>\n<p><strong>NOTE</strong>: For now, we are keeping the same classes as the upstream predictor system which is as follows:\n1. &lt;2wk = bad\n2. 2wk-6wk = warning\n3. &gt;6wk = good</p>\n<h2>Steps</h2>\n<ol>\n<li>Segregate data into good medium bad. This way it can be used for ovo, ova, or multiclass classifier</li>\n<li>Train multiclass classifier</li>\n<li>ova</li>\n<li>ovo</li>\n</ol></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Get Data</h2>\n<p>Get data in a format that is easier/more efficient to work with. e.g. only take columns that will be used for training, add rul column, etc</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[1]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">import</span> os\n<span class=\"token\" style=\"color:#0000ff\">import</span> gc\n<span class=\"token\" style=\"color:#0000ff\">import</span> sys\nSRC_PATH <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&#x27;../src&#x27;</span>\n<span class=\"token\" style=\"color:#0000ff\">if</span> SRC_PATH <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#0000ff\">in</span> sys<span class=\"token\" style=\"color:#393A34\">.</span>path<span class=\"token\" style=\"color:#393A34\">:</span>\n    sys<span class=\"token\" style=\"color:#393A34\">.</span>path<span class=\"token\" style=\"color:#393A34\">.</span>insert<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">,</span> SRC_PATH<span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">import</span> utils\n<span class=\"token\" style=\"color:#0000ff\">import</span> datetime\n<span class=\"token\" style=\"color:#0000ff\">import</span> pickle\n<span class=\"token\" style=\"color:#0000ff\">import</span> cloudpickle\n\n<span class=\"token\" style=\"color:#0000ff\">import</span> numpy <span class=\"token\" style=\"color:#0000ff\">as</span> np\n<span class=\"token\" style=\"color:#0000ff\">import</span> pandas <span class=\"token\" style=\"color:#0000ff\">as</span> pd\n<span class=\"token\" style=\"color:#0000ff\">import</span> dask<span class=\"token\" style=\"color:#393A34\">.</span>dataframe <span class=\"token\" style=\"color:#0000ff\">as</span> dd\n<span class=\"token\" style=\"color:#0000ff\">from</span> dask<span class=\"token\" style=\"color:#393A34\">.</span>distributed <span class=\"token\" style=\"color:#0000ff\">import</span> Client\n<span class=\"token\" style=\"color:#0000ff\">from</span> dask<span class=\"token\" style=\"color:#393A34\">.</span>diagnostics <span class=\"token\" style=\"color:#0000ff\">import</span> ProgressBar\n\n<span class=\"token\" style=\"color:#0000ff\">from</span> sklearn<span class=\"token\" style=\"color:#393A34\">.</span>metrics <span class=\"token\" style=\"color:#0000ff\">import</span> confusion_matrix\n<span class=\"token\" style=\"color:#0000ff\">from</span> sklearn<span class=\"token\" style=\"color:#393A34\">.</span>metrics <span class=\"token\" style=\"color:#0000ff\">import</span> pairwise_distances_argmin\n<span class=\"token\" style=\"color:#0000ff\">from</span> sklearn<span class=\"token\" style=\"color:#393A34\">.</span>metrics <span class=\"token\" style=\"color:#0000ff\">import</span> classification_report<span class=\"token\" style=\"color:#393A34\">,</span> precision_recall_fscore_support\n\n<span class=\"token\" style=\"color:#0000ff\">import</span> joblib\n<span class=\"token\" style=\"color:#0000ff\">from</span> joblib <span class=\"token\" style=\"color:#0000ff\">import</span> parallel_backend</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[2]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">from</span> matplotlib <span class=\"token\" style=\"color:#0000ff\">import</span> pyplot <span class=\"token\" style=\"color:#0000ff\">as</span> plt\n<span class=\"token\" style=\"color:#0000ff\">import</span> seaborn <span class=\"token\" style=\"color:#0000ff\">as</span> sns\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Display all cell outputs</span>\n<span class=\"token\" style=\"color:#0000ff\">from</span> IPython<span class=\"token\" style=\"color:#393A34\">.</span>core<span class=\"token\" style=\"color:#393A34\">.</span>interactiveshell <span class=\"token\" style=\"color:#0000ff\">import</span> InteractiveShell\nInteractiveShell<span class=\"token\" style=\"color:#393A34\">.</span>ast_node_interactivity <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&#x27;all&#x27;</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[3]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">pbar <span class=\"token\" style=\"color:#393A34\">=</span> ProgressBar<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\npbar<span class=\"token\" style=\"color:#393A34\">.</span>register<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># client = Client()</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[4]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># inferred int64 types cause a type mismatch (int vs float) error when dask sees a null value</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># null values cannot be interpreted as ints</span>\ncustom_dtypes <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">{</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;seagate&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#393A34\">{</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;date&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;object&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;serial_number&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;object&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;capacity_bytes&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;failure&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_1_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_1_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_5_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_5_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_7_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_7_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_9_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_9_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_10_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_10_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_184_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_184_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_187_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_187_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_188_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_188_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_189_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_189_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_190_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_190_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_193_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_193_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_194_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_194_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_197_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_197_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_198_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_198_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_240_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_240_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_241_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_241_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_242_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_242_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span>\n<span class=\"token\" style=\"color:#393A34\">}</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;hgst&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#393A34\">{</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;date&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;object&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;serial_number&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;object&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;model&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;object&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;capacity_bytes&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;failure&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_1_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_1_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_2_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_2_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_3_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_3_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_4_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_4_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_5_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_5_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_7_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_7_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_8_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_8_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_9_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_9_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_10_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_10_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_12_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_12_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_22_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_22_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_192_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_192_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_193_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_193_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_194_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_194_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_196_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_196_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_197_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_197_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_198_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_198_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_199_normalized&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;smart_199_raw&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;float32&quot;</span>\n<span class=\"token\" style=\"color:#393A34\">}</span><span class=\"token\" style=\"color:#393A34\">}</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[5]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># read all the cleaned seagate data into one dataframe</span>\nMANUFACTURER <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;seagate&quot;</span>\nDATA_DIR <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;/home/kachauha/Downloads&quot;</span>\ndf4 <span class=\"token\" style=\"color:#393A34\">=</span> dd<span class=\"token\" style=\"color:#393A34\">.</span>read_csv<span class=\"token\" style=\"color:#393A34\">(</span>os<span class=\"token\" style=\"color:#393A34\">.</span>path<span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span>DATA_DIR<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;data_Q4_2018_{}_clean&#x27;</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">format</span><span class=\"token\" style=\"color:#393A34\">(</span>MANUFACTURER<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;*.csv&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> dtype<span class=\"token\" style=\"color:#393A34\">=</span>custom_dtypes<span class=\"token\" style=\"color:#393A34\">[</span>MANUFACTURER<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\ndf3 <span class=\"token\" style=\"color:#393A34\">=</span> dd<span class=\"token\" style=\"color:#393A34\">.</span>read_csv<span class=\"token\" style=\"color:#393A34\">(</span>os<span class=\"token\" style=\"color:#393A34\">.</span>path<span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span>DATA_DIR<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;data_Q3_2018_{}_clean&#x27;</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">format</span><span class=\"token\" style=\"color:#393A34\">(</span>MANUFACTURER<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;*.csv&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> dtype<span class=\"token\" style=\"color:#393A34\">=</span>custom_dtypes<span class=\"token\" style=\"color:#393A34\">[</span>MANUFACTURER<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\ndf <span class=\"token\" style=\"color:#393A34\">=</span> dd<span class=\"token\" style=\"color:#393A34\">.</span>concat<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">[</span>df3<span class=\"token\" style=\"color:#393A34\">,</span> df4<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> interleave_partitions<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\ndf <span class=\"token\" style=\"color:#393A34\">=</span> utils<span class=\"token\" style=\"color:#393A34\">.</span>optimal_repartition_df<span class=\"token\" style=\"color:#393A34\">(</span>df<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>[########################################] | 100% Completed | 37.6s\n</span></code></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[6]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># define thresholds as timedelta</span>\nBAD_THRESHOLD_NDAYS <span class=\"token\" style=\"color:#393A34\">=</span> np<span class=\"token\" style=\"color:#393A34\">.</span>timedelta64<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#36acaa\">14</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;D&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nWARNING_THRESHOLD_NDAYS <span class=\"token\" style=\"color:#393A34\">=</span> np<span class=\"token\" style=\"color:#393A34\">.</span>timedelta64<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#36acaa\">42</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;D&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h3>Get Failed Drives Data</h3></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[7]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># get the serial numbers for all the failed hard drives</span>\nfailed_serials <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">[</span>df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;failure&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">==</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>compute<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># failed drives data</span>\nfailed_df <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">[</span>df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>isin<span class=\"token\" style=\"color:#393A34\">(</span>failed_serials<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span>\nfailed_df<span class=\"token\" style=\"color:#393A34\">.</span>head<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>[########################################] | 100% Completed | 24.0s\n[########################################] | 100% Completed |  1.0s\n</span></code><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>date</th>\n      <th>serial_number</th>\n      <th>capacity_bytes</th>\n      <th>failure</th>\n      <th>smart_1_raw</th>\n      <th>smart_5_raw</th>\n      <th>smart_7_raw</th>\n      <th>smart_9_raw</th>\n      <th>smart_10_raw</th>\n      <th>smart_184_raw</th>\n      <th>...</th>\n      <th>smart_188_normalized</th>\n      <th>smart_189_normalized</th>\n      <th>smart_190_normalized</th>\n      <th>smart_193_normalized</th>\n      <th>smart_194_normalized</th>\n      <th>smart_197_normalized</th>\n      <th>smart_198_normalized</th>\n      <th>smart_240_normalized</th>\n      <th>smart_241_normalized</th>\n      <th>smart_242_normalized</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>60</th>\n      <td>2018-07-01</td>\n      <td>S301GMGW</td>\n      <td>4.000787e+12</td>\n      <td>0.0</td>\n      <td>171832640.0</td>\n      <td>0.0</td>\n      <td>6.912202e+07</td>\n      <td>25241.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>78.0</td>\n      <td>63.0</td>\n      <td>22.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n    </tr>\n    <tr>\n      <th>243</th>\n      <td>2018-07-01</td>\n      <td>Z304KR3C</td>\n      <td>4.000787e+12</td>\n      <td>0.0</td>\n      <td>230540768.0</td>\n      <td>0.0</td>\n      <td>2.555230e+08</td>\n      <td>23960.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>81.0</td>\n      <td>98.0</td>\n      <td>19.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n    </tr>\n    <tr>\n      <th>613</th>\n      <td>2018-07-01</td>\n      <td>ZCH0CDHJ</td>\n      <td>1.200014e+13</td>\n      <td>0.0</td>\n      <td>125181424.0</td>\n      <td>0.0</td>\n      <td>2.146338e+08</td>\n      <td>2901.0</td>\n      <td>0.0</td>\n      <td>-100.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>-100.0</td>\n      <td>71.0</td>\n      <td>100.0</td>\n      <td>29.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n    </tr>\n    <tr>\n      <th>840</th>\n      <td>2018-07-01</td>\n      <td>ZA171RYT</td>\n      <td>8.001563e+12</td>\n      <td>0.0</td>\n      <td>116709632.0</td>\n      <td>56.0</td>\n      <td>2.516390e+09</td>\n      <td>10216.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>77.0</td>\n      <td>94.0</td>\n      <td>23.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n    </tr>\n    <tr>\n      <th>1144</th>\n      <td>2018-07-01</td>\n      <td>ZCH07J8T</td>\n      <td>1.200014e+13</td>\n      <td>0.0</td>\n      <td>182899248.0</td>\n      <td>0.0</td>\n      <td>7.768506e+08</td>\n      <td>5908.0</td>\n      <td>0.0</td>\n      <td>-100.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>-100.0</td>\n      <td>66.0</td>\n      <td>100.0</td>\n      <td>34.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n    </tr>\n  </tbody>\n</table>\n<p>5 rows Ã— 38 columns</p>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[8]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># number of days of data available for failed drives</span>\ndays <span class=\"token\" style=\"color:#393A34\">=</span> failed_df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;date&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;failure&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>groupby<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>size<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>compute<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\nplt<span class=\"token\" style=\"color:#393A34\">.</span>hist<span class=\"token\" style=\"color:#393A34\">(</span>days<span class=\"token\" style=\"color:#393A34\">,</span> bins<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">7</span><span class=\"token\" style=\"color:#393A34\">)</span>    <span class=\"token\" style=\"color:#008000;font-style:italic\"># 92 days / 2 weeks = 7 bins</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>[########################################] | 100% Completed | 25.1s\n</span></code><pre><code><span>(array([110.,  94., 105.,  81.,  83.,  94.,  77.]),\n array([  1.        ,  27.14285714,  53.28571429,  79.42857143,\n        105.57142857, 131.71428571, 157.85714286, 184.        ]),\n &lt;a list of 7 Patch objects&gt;)</span></code></pre><img alt=\"\" src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXcAAAD4CAYAAAAXUaZHAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4xLjEsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy8QZhcZAAAOc0lEQVR4nO3da4xcZ33H8e+vMYESLs5lZblJWpvWpcqbNtGKpgqgiqA2F4rTFkWJUHFpJKsStFBagWmkhpdJL1CQUJBLUkyVhqQBFKtXUjcU9UXcrhNDnJgQExKw5dgLlIQWVEj598Uct5PNbuyds7sz8/T7kUZzznPOmfPXM7O/PfPMnDOpKiRJbfmhcRcgSVp5hrskNchwl6QGGe6S1CDDXZIatG7cBQCcc845tWnTpnGXIUlTZd++fV+vqpnFlk1EuG/atIm5ublxlyFJUyXJE0stc1hGkhpkuEtSgwx3SWqQ4S5JDTLcJalBhrskNchwl6QGGe6S1CDDXZIaNBFnqPaxacffjLuEZXn8xivHXYKk/wc8cpekBhnuktQgw12SGmS4S1KDDHdJapDhLkkNMtwlqUGGuyQ1aOpPYtLq8QQxaXp55C5JDTLcJalBhrskNchwl6QGGe6S1KCThnuSW5McT3JgqO2sJPckebS7P7NrT5IPJTmU5AtJLlrN4iVJizuVI/ePAZctaNsB7KmqLcCebh7gcmBLd9sO3LwyZUqSluOk4V5VnwO+uaB5K7Crm94FXDXU/vEauA9Yn2TjShUrSTo1o465b6iqo930k8CGbvpc4GtD6x3u2iRJa6j3B6pVVUAtd7sk25PMJZmbn5/vW4Ykacio4X7sxHBLd3+8az8CnD+03nld23NU1c6qmq2q2ZmZmRHLkCQtZtRw3w1s66a3AXcPtb+l+9bMxcBTQ8M3kqQ1ctILhyW5Hfh54Jwkh4EbgBuBO5NcBzwBXN2t/rfAFcAh4DvAW1ehZknSSZw03Kvq2iUWXbrIugW8rW9RkqR+PENVkhpkuEtSgwx3SWqQ4S5JDTLcJalBhrskNcgfyF5j0/aj0xJM1+vWH0of8MhdkhpkuEtSgwx3SWqQ4S5JDTLcJalBhrskNchwl6QGGe6S1CDDXZIaZLhLUoMMd0lqkOEuSQ0y3CWpQYa7JDXIcJekBhnuktQgw12SGmS4S1KDDHdJapDhLkkN8geypTGYph+c1nTyyF2SGtQr3JP8TpKHkhxIcnuSFyXZnGRvkkNJ7khy+koVK0k6NSMPyyQ5F/ht4IKq+m6SO4FrgCuAD1TVJ5J8BLgOuHlFqpWeh0Md0v/pOyyzDvjhJOuAFwNHgdcBd3XLdwFX9dyHJGmZRg73qjoC/DHwVQah/hSwD/hWVT3TrXYYOHex7ZNsTzKXZG5+fn7UMiRJixg53JOcCWwFNgM/ApwBXHaq21fVzqqararZmZmZUcuQJC2iz7DM64GvVNV8VX0f+BRwCbC+G6YBOA840rNGSdIy9Qn3rwIXJ3lxkgCXAg8D9wJv6tbZBtzdr0RJ0nL1GXPfy+CD0/uBB7vH2gm8B3hXkkPA2cAtK1CnJGkZep2hWlU3ADcsaH4MeFWfx5Uk9ePlByQ1ZdrOd3j8xitX5XG9/IAkNchwl6QGGe6S1CDDXZIaZLhLUoMMd0lqkOEuSQ0y3CWpQYa7JDXIcJekBhnuktQgw12SGmS4S1KDDHdJapDhLkkNMtwlqUGGuyQ1yHCXpAYZ7pLUIMNdkhpkuEtSgwx3SWqQ4S5JDTLcJalBhrskNchwl6QGGe6S1CDDXZIa1Cvck6xPcleSLyY5mOTnkpyV5J4kj3b3Z65UsZKkU9P3yP2DwN9X1U8BPw0cBHYAe6pqC7Cnm5ckraGRwz3Jy4HXArcAVNX3qupbwFZgV7faLuCqvkVKkpanz5H7ZmAe+PMkDyT5aJIzgA1VdbRb50lgw2IbJ9meZC7J3Pz8fI8yJEkL9Qn3dcBFwM1VdSHwnywYgqmqAmqxjatqZ1XNVtXszMxMjzIkSQv1CffDwOGq2tvN38Ug7I8l2QjQ3R/vV6IkablGDveqehL4WpJXdk2XAg8Du4FtXds24O5eFUqSlm1dz+1/C7gtyenAY8BbGfzDuDPJdcATwNU99yFJWqZe4V5V+4HZRRZd2udxJUn9eIaqJDXIcJekBhnuktQgw12SGmS4S1KDDHdJapDhLkkNMtwlqUGGuyQ1yHCXpAYZ7pLUIMNdkhpkuEtSgwx3SWqQ4S5JDTLcJalBhrskNchwl6QGGe6S1CDDXZIaZLhLUoMMd0lqkOEuSQ0y3CWpQYa7JDXIcJekBhnuktQgw12SGtQ73JOcluSBJH/dzW9OsjfJoSR3JDm9f5mSpOVYiSP3dwAHh+ZvAj5QVT8B/Dtw3QrsQ5K0DL3CPcl5wJXAR7v5AK8D7upW2QVc1WcfkqTl63vk/qfAu4EfdPNnA9+qqme6+cPAuYttmGR7krkkc/Pz8z3LkCQNGznck7wBOF5V+0bZvqp2VtVsVc3OzMyMWoYkaRHremx7CfDGJFcALwJeBnwQWJ9kXXf0fh5wpH+ZkqTlGPnIvareW1XnVdUm4Brgn6rqzcC9wJu61bYBd/euUpK0LKvxPff3AO9KcojBGPwtq7APSdLz6DMs87+q6rPAZ7vpx4BXrcTjSpJG4xmqktQgw12SGmS4S1KDDHdJapDhLkkNMtwlqUGGuyQ1yHCXpAYZ7pLUIMNdkhpkuEtSgwx3SWqQ4S5JDTLcJalBhrskNchwl6QGGe6S1CDDXZIaZLhLUoMMd0lqkOEuSQ0y3CWpQYa7JDXIcJekBhnuktQgw12SGmS4S1KDDHdJapDhLkkNGjnck5yf5N4kDyd5KMk7uvazktyT5NHu/syVK1eSdCr6HLk/A/xuVV0AXAy8LckFwA5gT1VtAfZ085KkNTRyuFfV0aq6v5v+NnAQOBfYCuzqVtsFXNW3SEnS8qzImHuSTcCFwF5gQ1Ud7RY9CWxYYpvtSeaSzM3Pz69EGZKkTu9wT/IS4JPAO6vq6eFlVVVALbZdVe2sqtmqmp2ZmelbhiRpSK9wT/ICBsF+W1V9qms+lmRjt3wjcLxfiZKk5erzbZkAtwAHq+r9Q4t2A9u66W3A3aOXJ0kaxboe214C/BrwYJL9XdvvAzcCdya5DngCuLpfiZKk5Ro53KvqX4AssfjSUR9XktSfZ6hKUoMMd0lqkOEuSQ0y3CWpQYa7JDXIcJekBhnuktQgw12SGmS4S1KDDHdJapDhLkkNMtwlqUGGuyQ1yHCXpAYZ7pLUIMNdkhpkuEtSgwx3SWqQ4S5JDTLcJalBhrskNchwl6QGGe6S1CDDXZIaZLhLUoMMd0lqkOEuSQ0y3CWpQYa7JDVoVcI9yWVJHklyKMmO1diHJGlpKx7uSU4DPgxcDlwAXJvkgpXejyRpaatx5P4q4FBVPVZV3wM+AWxdhf1IkpawbhUe81zga0Pzh4GfXbhSku3A9m72P5I8MsK+zgG+PsJ2a2kaaoTpqHMaagTrXEnTUCP0qDM39drvjy21YDXC/ZRU1U5gZ5/HSDJXVbMrVNKqmIYaYTrqnIYawTpX0jTUCJNZ52oMyxwBzh+aP69rkyStkdUI938DtiTZnOR04Bpg9yrsR5K0hBUflqmqZ5K8HfgH4DTg1qp6aKX30+k1rLNGpqFGmI46p6FGsM6VNA01wgTWmaoadw2SpBXmGaqS1CDDXZIaNJXhPqmXN0hyfpJ7kzyc5KEk7+ja35fkSJL93e2KMdf5eJIHu1rmurazktyT5NHu/swx1/jKof7an+TpJO+chL5McmuS40kODLUt2n8Z+FD3Wv1CkovGWOMfJfliV8enk6zv2jcl+e5Qn35kLWp8njqXfI6TvLfry0eS/OIYa7xjqL7Hk+zv2sfWl89RVVN1Y/Ah7ZeBVwCnA58HLhh3XV1tG4GLuumXAl9icAmG9wG/N+76hup8HDhnQdsfAju66R3ATeOuc8Fz/iSDEzbG3pfAa4GLgAMn6z/gCuDvgAAXA3vHWOMvAOu66ZuGatw0vN4E9OWiz3H3t/R54IXA5i4HThtHjQuW/wnwB+Puy4W3aTxyn9jLG1TV0aq6v5v+NnCQwRm702ArsKub3gVcNcZaFroU+HJVPTHuQgCq6nPANxc0L9V/W4GP18B9wPokG8dRY1V9pqqe6WbvY3AOylgt0ZdL2Qp8oqr+q6q+AhxikAer6vlqTBLgauD21a5juaYx3Be7vMHEBWiSTcCFwN6u6e3d2+Fbxz3kARTwmST7ustAAGyoqqPd9JPAhvGUtqhrePYfzyT15QlL9d+kvl5/g8E7ihM2J3kgyT8nec24ihqy2HM8iX35GuBYVT061DYRfTmN4T7xkrwE+CTwzqp6GrgZ+HHgZ4CjDN7GjdOrq+oiBlfufFuS1w4vrMH7y4n4jmx3Itwbgb/qmiatL59jkvpvMUmuB54BbuuajgI/WlUXAu8C/jLJy8ZVH1PwHA+5lmcfeExMX05juE/05Q2SvIBBsN9WVZ8CqKpjVfXfVfUD4M9Yg7eSz6eqjnT3x4FPd/UcOzFc0N0fH1+Fz3I5cH9VHYPJ68shS/XfRL1ek/w68Abgzd0/Ibphjm900/sYjGX/5LhqfJ7neNL6ch3wK8AdJ9omqS+nMdwn9vIG3fjbLcDBqnr/UPvwGOsvAwcWbrtWkpyR5KUnphl8yHaAQR9u61bbBtw9ngqf41lHRpPUlwss1X+7gbd035q5GHhqaPhmTSW5DHg38Maq+s5Q+0wGv8NAklcAW4DHxlFjV8NSz/Fu4JokL0yymUGd/7rW9Q15PfDFqjp8omGi+nLcn+iOcmPwDYQvMfiveP246xmq69UM3o5/Adjf3a4A/gJ4sGvfDWwcY42vYPCNg88DD53oP+BsYA/wKPCPwFkT0J9nAN8AXj7UNva+ZPDP5ijwfQbjvtct1X8MviXz4e61+iAwO8YaDzEYsz7x2vxIt+6vdq+F/cD9wC+NuS+XfI6B67u+fAS4fFw1du0fA35zwbpj68uFNy8/IEkNmsZhGUnSSRjuktQgw12SGmS4S1KDDHdJapDhLkkNMtwlqUH/A1TrwLacF5YSAAAAAElFTkSuQmCC\n\" class=\"sc-bdVaJa jFcqvn\"/></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h3>Downsample Working Drives</h3></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[9]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># extract mean,std,capacity for working drives</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># but first, drop the columns for which it doesnt make sense the &quot;aggregate&quot; values</span>\ndrop_cols <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;date&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;capacity_bytes&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;failure&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># FIXME: this is a temp fix. ideally, we should remove model column from the clean data for hgst</span>\n<span class=\"token\" style=\"color:#0000ff\">if</span> MANUFACTURER<span class=\"token\" style=\"color:#393A34\">.</span>lower<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;seagate&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    drop_cols<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;model&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nworking_feats_df <span class=\"token\" style=\"color:#393A34\">=</span> utils<span class=\"token\" style=\"color:#393A34\">.</span>featurize_ts<span class=\"token\" style=\"color:#393A34\">(</span>df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">~</span>df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>isin<span class=\"token\" style=\"color:#393A34\">(</span>failed_serials<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span>\n                                      drop_cols<span class=\"token\" style=\"color:#393A34\">=</span>drop_cols<span class=\"token\" style=\"color:#393A34\">,</span>\n                                      num_days<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\nworking_feats_df<span class=\"token\" style=\"color:#393A34\">.</span>head<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>[########################################] | 100% Completed |  1min 11.7s\n</span></code><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>mean_smart_1_raw</th>\n      <th>mean_smart_5_raw</th>\n      <th>mean_smart_7_raw</th>\n      <th>mean_smart_9_raw</th>\n      <th>mean_smart_10_raw</th>\n      <th>mean_smart_184_raw</th>\n      <th>mean_smart_187_raw</th>\n      <th>mean_smart_188_raw</th>\n      <th>mean_smart_189_raw</th>\n      <th>mean_smart_190_raw</th>\n      <th>...</th>\n      <th>std_smart_190_normalized</th>\n      <th>std_smart_193_normalized</th>\n      <th>std_smart_194_normalized</th>\n      <th>std_smart_197_normalized</th>\n      <th>std_smart_198_normalized</th>\n      <th>std_smart_240_normalized</th>\n      <th>std_smart_241_normalized</th>\n      <th>std_smart_242_normalized</th>\n      <th>capacity_bytes</th>\n      <th>num_days</th>\n    </tr>\n    <tr>\n      <th>serial_number</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>6VDHZ71D</th>\n      <td>1.120956e+08</td>\n      <td>0.0</td>\n      <td>3.795581e+08</td>\n      <td>40377.923077</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>17.0</td>\n      <td>0.0</td>\n      <td>26.318681</td>\n      <td>...</td>\n      <td>0.837115</td>\n      <td>0.0</td>\n      <td>0.837042</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>3.200729e+11</td>\n      <td>91</td>\n    </tr>\n    <tr>\n      <th>6VDHZ9H9</th>\n      <td>1.234109e+08</td>\n      <td>0.0</td>\n      <td>2.872033e+08</td>\n      <td>39796.008696</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>18.0</td>\n      <td>0.0</td>\n      <td>27.530435</td>\n      <td>...</td>\n      <td>0.772789</td>\n      <td>0.0</td>\n      <td>0.772593</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>3.200729e+11</td>\n      <td>115</td>\n    </tr>\n    <tr>\n      <th>6VDHZA4H</th>\n      <td>1.271050e+08</td>\n      <td>0.0</td>\n      <td>3.796565e+08</td>\n      <td>40328.606742</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>12.0</td>\n      <td>0.0</td>\n      <td>25.404494</td>\n      <td>...</td>\n      <td>0.817295</td>\n      <td>0.0</td>\n      <td>0.817218</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>3.200729e+11</td>\n      <td>89</td>\n    </tr>\n    <tr>\n      <th>6VDHZAFY</th>\n      <td>1.205417e+08</td>\n      <td>0.0</td>\n      <td>3.796991e+08</td>\n      <td>40089.560440</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>8.0</td>\n      <td>0.0</td>\n      <td>31.439560</td>\n      <td>...</td>\n      <td>0.682824</td>\n      <td>0.0</td>\n      <td>0.682735</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>3.200729e+11</td>\n      <td>91</td>\n    </tr>\n    <tr>\n      <th>6VDHZAKY</th>\n      <td>1.320863e+08</td>\n      <td>0.0</td>\n      <td>2.881417e+08</td>\n      <td>40232.347826</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>19.0</td>\n      <td>0.0</td>\n      <td>27.147826</td>\n      <td>...</td>\n      <td>2.258360</td>\n      <td>0.0</td>\n      <td>2.258293</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>3.200729e+11</td>\n      <td>115</td>\n    </tr>\n  </tbody>\n</table>\n<p>5 rows Ã— 70 columns</p>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[8]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">from</span> sklearn<span class=\"token\" style=\"color:#393A34\">.</span>cluster <span class=\"token\" style=\"color:#0000ff\">import</span> SpectralClustering<span class=\"token\" style=\"color:#393A34\">,</span> MiniBatchKMeans\n<span class=\"token\" style=\"color:#0000ff\">from</span> sklearn<span class=\"token\" style=\"color:#393A34\">.</span>metrics<span class=\"token\" style=\"color:#393A34\">.</span>pairwise <span class=\"token\" style=\"color:#0000ff\">import</span> cosine_similarity</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p><strong>FIXME</strong> euclidean distance is not a good measure for such a high dimensional data, but even dask spectral clustering runs out of memory so we dont have an option.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p><strong>TODO</strong> Try dask kmeans or spectral clustering to get more working serials</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h4>TODO: kmeans does not reach &gt;350 centers</h4></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[9]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># apply clustering to get the serial numbers that best represent the working drives</span>\nnum_working_serials <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">5000</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># sc = SpectralClustering(n_clusters=num_working_serials, </span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#                         affinity=cosine_similarity, </span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># #                         n_neighbors=50,</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#                         n_jobs=-1)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># sc = SpectralClustering(n_clusters=num_working_serials, n_jobs=-1)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># minikm = MiniBatchKMeans(n_clusters=num_working_serials, max_iter=1e5, batch_size=500)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># working_repr_sers = utils.get_downsampled_working_sers(working_feats_df.compute(), num_working_serials, model=minikm)</span>\nworking_sers <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">~</span>df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>isin<span class=\"token\" style=\"color:#393A34\">(</span>failed_serials<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>unique<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\nworking_repr_sers <span class=\"token\" style=\"color:#393A34\">=</span> working_sers<span class=\"token\" style=\"color:#393A34\">.</span>sample<span class=\"token\" style=\"color:#393A34\">(</span>frac<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">(</span>num_working_serials<span class=\"token\" style=\"color:#393A34\">/</span><span class=\"token builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>working_sers<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>compute<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># downsample the dataset</span>\nworking_df <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">[</span>df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>isin<span class=\"token\" style=\"color:#393A34\">(</span>working_repr_sers<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span>\nworking_df<span class=\"token\" style=\"color:#393A34\">.</span>head<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>[########################################] | 100% Completed | 25.7s\n[########################################] | 100% Completed | 25.3s\n[########################################] | 100% Completed |  0.8s\n</span></code><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>date</th>\n      <th>serial_number</th>\n      <th>capacity_bytes</th>\n      <th>failure</th>\n      <th>smart_1_raw</th>\n      <th>smart_5_raw</th>\n      <th>smart_7_raw</th>\n      <th>smart_9_raw</th>\n      <th>smart_10_raw</th>\n      <th>smart_184_raw</th>\n      <th>...</th>\n      <th>smart_188_normalized</th>\n      <th>smart_189_normalized</th>\n      <th>smart_190_normalized</th>\n      <th>smart_193_normalized</th>\n      <th>smart_194_normalized</th>\n      <th>smart_197_normalized</th>\n      <th>smart_198_normalized</th>\n      <th>smart_240_normalized</th>\n      <th>smart_241_normalized</th>\n      <th>smart_242_normalized</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>8</th>\n      <td>2018-07-01</td>\n      <td>ZJV02XWV</td>\n      <td>1.200014e+13</td>\n      <td>0.0</td>\n      <td>53340920.0</td>\n      <td>0.0</td>\n      <td>1.717476e+08</td>\n      <td>1259.0</td>\n      <td>0.0</td>\n      <td>-100.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>-100.0</td>\n      <td>75.0</td>\n      <td>100.0</td>\n      <td>25.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n    </tr>\n    <tr>\n      <th>20</th>\n      <td>2018-07-01</td>\n      <td>ZA13YGBG</td>\n      <td>8.001563e+12</td>\n      <td>0.0</td>\n      <td>158767616.0</td>\n      <td>0.0</td>\n      <td>3.104080e+09</td>\n      <td>13910.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>73.0</td>\n      <td>95.0</td>\n      <td>27.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n    </tr>\n    <tr>\n      <th>27</th>\n      <td>2018-07-01</td>\n      <td>S301NGZV</td>\n      <td>4.000787e+12</td>\n      <td>0.0</td>\n      <td>31363312.0</td>\n      <td>0.0</td>\n      <td>8.219142e+07</td>\n      <td>23424.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>76.0</td>\n      <td>92.0</td>\n      <td>24.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n    </tr>\n    <tr>\n      <th>46</th>\n      <td>2018-07-01</td>\n      <td>Z305AJF7</td>\n      <td>4.000787e+12</td>\n      <td>0.0</td>\n      <td>5959552.0</td>\n      <td>0.0</td>\n      <td>7.817990e+07</td>\n      <td>21588.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>81.0</td>\n      <td>96.0</td>\n      <td>19.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n    </tr>\n    <tr>\n      <th>50</th>\n      <td>2018-07-01</td>\n      <td>ZA10RYBR</td>\n      <td>8.001563e+12</td>\n      <td>0.0</td>\n      <td>37112328.0</td>\n      <td>0.0</td>\n      <td>1.575094e+09</td>\n      <td>17024.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>58.0</td>\n      <td>100.0</td>\n      <td>42.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n    </tr>\n  </tbody>\n</table>\n<p>5 rows Ã— 38 columns</p>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h3>Combine Failed and Working Drives</h3>\n<p>Even the combined data should be small enough since we have downsampled significantly. Therefore bring the combined df in memory so it is easier to work with</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[10]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># concatenate rows</span>\ndf <span class=\"token\" style=\"color:#393A34\">=</span> failed_df<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span>working_df<span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># drop columns that wont be useful for prediction</span>\n<span class=\"token\" style=\"color:#0000ff\">if</span> MANUFACTURER <span class=\"token\" style=\"color:#393A34\">==</span> <span class=\"token\" style=\"color:#A31515\">&quot;hgst&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    df <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">.</span>drop<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;model&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\ndf<span class=\"token\" style=\"color:#393A34\">.</span>head<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>[########################################] | 100% Completed |  0.8s\n</span></code><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>date</th>\n      <th>serial_number</th>\n      <th>capacity_bytes</th>\n      <th>failure</th>\n      <th>smart_1_raw</th>\n      <th>smart_5_raw</th>\n      <th>smart_7_raw</th>\n      <th>smart_9_raw</th>\n      <th>smart_10_raw</th>\n      <th>smart_184_raw</th>\n      <th>...</th>\n      <th>smart_188_normalized</th>\n      <th>smart_189_normalized</th>\n      <th>smart_190_normalized</th>\n      <th>smart_193_normalized</th>\n      <th>smart_194_normalized</th>\n      <th>smart_197_normalized</th>\n      <th>smart_198_normalized</th>\n      <th>smart_240_normalized</th>\n      <th>smart_241_normalized</th>\n      <th>smart_242_normalized</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>60</th>\n      <td>2018-07-01</td>\n      <td>S301GMGW</td>\n      <td>4.000787e+12</td>\n      <td>0.0</td>\n      <td>171832640.0</td>\n      <td>0.0</td>\n      <td>6.912202e+07</td>\n      <td>25241.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>78.0</td>\n      <td>63.0</td>\n      <td>22.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n    </tr>\n    <tr>\n      <th>243</th>\n      <td>2018-07-01</td>\n      <td>Z304KR3C</td>\n      <td>4.000787e+12</td>\n      <td>0.0</td>\n      <td>230540768.0</td>\n      <td>0.0</td>\n      <td>2.555230e+08</td>\n      <td>23960.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>81.0</td>\n      <td>98.0</td>\n      <td>19.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n    </tr>\n    <tr>\n      <th>613</th>\n      <td>2018-07-01</td>\n      <td>ZCH0CDHJ</td>\n      <td>1.200014e+13</td>\n      <td>0.0</td>\n      <td>125181424.0</td>\n      <td>0.0</td>\n      <td>2.146338e+08</td>\n      <td>2901.0</td>\n      <td>0.0</td>\n      <td>-100.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>-100.0</td>\n      <td>71.0</td>\n      <td>100.0</td>\n      <td>29.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n    </tr>\n    <tr>\n      <th>840</th>\n      <td>2018-07-01</td>\n      <td>ZA171RYT</td>\n      <td>8.001563e+12</td>\n      <td>0.0</td>\n      <td>116709632.0</td>\n      <td>56.0</td>\n      <td>2.516390e+09</td>\n      <td>10216.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>77.0</td>\n      <td>94.0</td>\n      <td>23.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n    </tr>\n    <tr>\n      <th>1144</th>\n      <td>2018-07-01</td>\n      <td>ZCH07J8T</td>\n      <td>1.200014e+13</td>\n      <td>0.0</td>\n      <td>182899248.0</td>\n      <td>0.0</td>\n      <td>7.768506e+08</td>\n      <td>5908.0</td>\n      <td>0.0</td>\n      <td>-100.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>-100.0</td>\n      <td>66.0</td>\n      <td>100.0</td>\n      <td>34.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n    </tr>\n  </tbody>\n</table>\n<p>5 rows Ã— 38 columns</p>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h3>Add RUL column</h3>\n<p><strong>NOTE</strong>: RUL values make sense only for the failed drives, because they have been observed to fail. For working drives, actual failure time is unknown and therefore RUL values are not meaningful. For the purposes of this notebook, RUL is used only as a tool for processing/labelling data </p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[11]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># convert from str to datetime</span>\ndf<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;date&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;date&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>astype<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;datetime64&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># =============================== FOR DASK =============================== #</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># create meta of the resulting failed_df otherwise dask complains</span>\nrul_meta <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">.</span>_meta\nrul_meta <span class=\"token\" style=\"color:#393A34\">=</span> rul_meta<span class=\"token\" style=\"color:#393A34\">.</span>assign<span class=\"token\" style=\"color:#393A34\">(</span>rul_days<span class=\"token\" style=\"color:#393A34\">=</span>rul_meta<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;date&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">max</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">-</span>rul_meta<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;date&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># ======================================================================== #</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># get remaining useful life as diff(today, maxday)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># reset index coz result is multiindexed. drop=True coz serial_number already exists as a col</span>\ndf <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">.</span>groupby<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">apply</span><span class=\"token\" style=\"color:#393A34\">(</span>utils<span class=\"token\" style=\"color:#393A34\">.</span>append_rul_days_column<span class=\"token\" style=\"color:#393A34\">,</span> meta<span class=\"token\" style=\"color:#393A34\">=</span>rul_meta<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>reset_index<span class=\"token\" style=\"color:#393A34\">(</span>drop<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[16]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">df<span class=\"token\" style=\"color:#393A34\">.</span>head<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>[########################################] | 100% Completed | 33.0s\n</span></code><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>date</th>\n      <th>serial_number</th>\n      <th>capacity_bytes</th>\n      <th>failure</th>\n      <th>smart_1_raw</th>\n      <th>smart_5_raw</th>\n      <th>smart_7_raw</th>\n      <th>smart_9_raw</th>\n      <th>smart_10_raw</th>\n      <th>smart_184_raw</th>\n      <th>...</th>\n      <th>smart_189_normalized</th>\n      <th>smart_190_normalized</th>\n      <th>smart_193_normalized</th>\n      <th>smart_194_normalized</th>\n      <th>smart_197_normalized</th>\n      <th>smart_198_normalized</th>\n      <th>smart_240_normalized</th>\n      <th>smart_241_normalized</th>\n      <th>smart_242_normalized</th>\n      <th>rul_days</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>2018-08-09</td>\n      <td>S300YQX2</td>\n      <td>4.000787e+12</td>\n      <td>0.0</td>\n      <td>50260496.0</td>\n      <td>0.0</td>\n      <td>402681536.0</td>\n      <td>27395.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>82.0</td>\n      <td>84.0</td>\n      <td>18.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>144 days</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2018-08-10</td>\n      <td>S300YQX2</td>\n      <td>4.000787e+12</td>\n      <td>0.0</td>\n      <td>42453640.0</td>\n      <td>0.0</td>\n      <td>403738272.0</td>\n      <td>27419.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>82.0</td>\n      <td>84.0</td>\n      <td>18.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>143 days</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2018-08-11</td>\n      <td>S300YQX2</td>\n      <td>4.000787e+12</td>\n      <td>0.0</td>\n      <td>11831192.0</td>\n      <td>0.0</td>\n      <td>405540256.0</td>\n      <td>27443.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>82.0</td>\n      <td>84.0</td>\n      <td>18.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>142 days</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2018-08-12</td>\n      <td>S300YQX2</td>\n      <td>4.000787e+12</td>\n      <td>0.0</td>\n      <td>47472400.0</td>\n      <td>0.0</td>\n      <td>406959968.0</td>\n      <td>27467.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>81.0</td>\n      <td>84.0</td>\n      <td>19.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>141 days</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2018-08-13</td>\n      <td>S300YQX2</td>\n      <td>4.000787e+12</td>\n      <td>0.0</td>\n      <td>203304240.0</td>\n      <td>0.0</td>\n      <td>407559328.0</td>\n      <td>27491.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>100.0</td>\n      <td>81.0</td>\n      <td>84.0</td>\n      <td>19.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>140 days</td>\n    </tr>\n  </tbody>\n</table>\n<p>5 rows Ã— 39 columns</p>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Create Rolling Aggregates</h2>\n<p>Instead of having raw values in rows, use rolling aggregates of those values. This is closer to the setup we will have during inference time. Also, this will provide more data points because there will be multiple data points for a single hard drive.</p>\n<p>It turns out that almost all the values being used as features are already simple rolling counts, and not instantaneous counts. The only instantaneous features are temperature related.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Add Multiclass Labels</h2>\n<p>All data points will be treated as unique data points. Labels will be added according to rul. The numerical representation of labels are as follows:\n1. 0 = good\n2. 1 = warning\n3. 2 = bad</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[12]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># remove working drive data that is recorded after [quarter end minus 6 weeks]</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># because we dont know (as of quarter end) if those drives survived more than 6 weeks or not</span>\ndf <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">(</span>df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>isin<span class=\"token\" style=\"color:#393A34\">(</span>failed_serials<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">|</span> <span class=\"token\" style=\"color:#393A34\">(</span>df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;rul_days&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">&gt;=</span> WARNING_THRESHOLD_NDAYS<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span>\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>dd<span class=\"token\" style=\"color:#393A34\">.</span>compute<span class=\"token\" style=\"color:#393A34\">(</span>df<span class=\"token\" style=\"color:#393A34\">.</span>shape<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>[########################################] | 100% Completed | 42.1s\n((669476, 39),)\n</span></code></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[13]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># NOTE: assignment must be done in th</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># df.head()is order otherwise it wont be correct. FIXME</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># assign all as good initially</span>\ndf<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;status&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">0</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># overwrite those which have rul less than 6 weeks as warning</span>\ndf<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;status&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;status&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>mask<span class=\"token\" style=\"color:#393A34\">(</span>df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;rul_days&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">&lt;</span> WARNING_THRESHOLD_NDAYS<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># overwrite those which have rul less than 2 weeks as bad</span>\ndf<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;status&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;status&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>mask<span class=\"token\" style=\"color:#393A34\">(</span>df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;rul_days&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">&lt;</span> BAD_THRESHOLD_NDAYS<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">2</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[14]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">df<span class=\"token\" style=\"color:#393A34\">.</span>head<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>[########################################] | 100% Completed | 29.4s\n</span></code><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>date</th>\n      <th>serial_number</th>\n      <th>capacity_bytes</th>\n      <th>failure</th>\n      <th>smart_1_raw</th>\n      <th>smart_5_raw</th>\n      <th>smart_7_raw</th>\n      <th>smart_9_raw</th>\n      <th>smart_10_raw</th>\n      <th>smart_184_raw</th>\n      <th>...</th>\n      <th>smart_190_normalized</th>\n      <th>smart_193_normalized</th>\n      <th>smart_194_normalized</th>\n      <th>smart_197_normalized</th>\n      <th>smart_198_normalized</th>\n      <th>smart_240_normalized</th>\n      <th>smart_241_normalized</th>\n      <th>smart_242_normalized</th>\n      <th>rul_days</th>\n      <th>status</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>2018-08-09</td>\n      <td>S300X3ZR</td>\n      <td>4.000787e+12</td>\n      <td>0.0</td>\n      <td>96868704.0</td>\n      <td>0.0</td>\n      <td>127312976.0</td>\n      <td>31228.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>78.0</td>\n      <td>74.0</td>\n      <td>22.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>144 days</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2018-08-10</td>\n      <td>S300X3ZR</td>\n      <td>4.000787e+12</td>\n      <td>0.0</td>\n      <td>116871608.0</td>\n      <td>0.0</td>\n      <td>127848144.0</td>\n      <td>31252.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>78.0</td>\n      <td>74.0</td>\n      <td>22.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>143 days</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2018-08-11</td>\n      <td>S300X3ZR</td>\n      <td>4.000787e+12</td>\n      <td>0.0</td>\n      <td>205206688.0</td>\n      <td>0.0</td>\n      <td>128310592.0</td>\n      <td>31276.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>78.0</td>\n      <td>74.0</td>\n      <td>22.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>142 days</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2018-08-12</td>\n      <td>S300X3ZR</td>\n      <td>4.000787e+12</td>\n      <td>0.0</td>\n      <td>42628720.0</td>\n      <td>0.0</td>\n      <td>128774160.0</td>\n      <td>31300.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>77.0</td>\n      <td>74.0</td>\n      <td>23.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>141 days</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2018-08-13</td>\n      <td>S300X3ZR</td>\n      <td>4.000787e+12</td>\n      <td>0.0</td>\n      <td>140203584.0</td>\n      <td>0.0</td>\n      <td>129248848.0</td>\n      <td>31324.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>78.0</td>\n      <td>74.0</td>\n      <td>22.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>100.0</td>\n      <td>140 days</td>\n      <td>0</td>\n    </tr>\n  </tbody>\n</table>\n<p>5 rows Ã— 40 columns</p>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Add diffs</h2>\n<p><strong>NOTE</strong> The following 3-4 cells show how the differentials from the previous 6 days, along with the rate of change, can be added as features to the dataframe. Initial experiments showed that this does not add much value for inference, and instead we will be generating some other features. But I will leave this here (but NOT run it) for experimentation purposes.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[67]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># columns for which diffs must be calculated</span>\ndiff_cols <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>col <span class=\"token\" style=\"color:#0000ff\">for</span> col <span class=\"token\" style=\"color:#0000ff\">in</span> df<span class=\"token\" style=\"color:#393A34\">.</span>columns <span class=\"token\" style=\"color:#0000ff\">if</span> col<span class=\"token\" style=\"color:#393A34\">.</span>lower<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>startswith<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;smart&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[93]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">add_deltas</span><span class=\"token\" style=\"color:#393A34\">(</span>group<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># FIXME: workaround for passing diff_cols as parameter</span>\n    <span class=\"token\" style=\"color:#0000ff\">global</span> diff_cols\n    <span class=\"token\" style=\"color:#0000ff\">for</span> colname <span class=\"token\" style=\"color:#0000ff\">in</span> diff_cols<span class=\"token\" style=\"color:#393A34\">:</span>\n        <span class=\"token\" style=\"color:#008000;font-style:italic\"># add rate of change</span>\n        roc_colname <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;d_&quot;</span> <span class=\"token\" style=\"color:#393A34\">+</span> colname\n        group<span class=\"token\" style=\"color:#393A34\">[</span>roc_colname<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">(</span>group<span class=\"token\" style=\"color:#393A34\">[</span>colname<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">-</span> group<span class=\"token\" style=\"color:#393A34\">[</span>colname<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>shift<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>fillna<span class=\"token\" style=\"color:#393A34\">(</span>method<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&#x27;bfill&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n        <span class=\"token\" style=\"color:#008000;font-style:italic\"># add rate of rate of change</span>\n        roroc_colname <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;d2_&quot;</span> <span class=\"token\" style=\"color:#393A34\">+</span> colname\n        group<span class=\"token\" style=\"color:#393A34\">[</span>roroc_colname<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">(</span>group<span class=\"token\" style=\"color:#393A34\">[</span>roc_colname<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">-</span> group<span class=\"token\" style=\"color:#393A34\">[</span>roc_colname<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>shift<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>fillna<span class=\"token\" style=\"color:#393A34\">(</span>method<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&#x27;bfill&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">return</span> group</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[95]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># # =============================== FOR DASK =============================== #</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># # create meta of the resulting failed_df otherwise dask complains</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># rul_meta = df._meta</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># rul_meta = rul_meta.assign(rul_days=rul_meta[&#x27;date&#x27;].max()-rul_meta[&#x27;date&#x27;])</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># # ======================================================================== #</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># get remaining useful life as diff(today, maxday)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># reset index coz result is multiindexed. drop=True coz serial_number already exists as a col</span>\ndf <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">.</span>groupby<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">apply</span><span class=\"token\" style=\"color:#393A34\">(</span>add_deltas<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>reset_index<span class=\"token\" style=\"color:#393A34\">(</span>drop<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stderr\"><span>/home/kachauha/.local/share/virtualenvs/ceph_drive_failure-3-2yJKyM/lib/python3.7/site-packages/ipykernel_launcher.py:9: UserWarning: `meta` is not specified, inferred from partial data. Please provide `meta` if the result is unexpected.\n  Before: .apply(func)\n  After:  .apply(func, meta={&#x27;x&#x27;: &#x27;f8&#x27;, &#x27;y&#x27;: &#x27;f8&#x27;}) for dataframe result\n  or:     .apply(func, meta=(&#x27;x&#x27;, &#x27;f8&#x27;))            for series result\n  if __name__ == &#x27;__main__&#x27;:\n</span></code></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p><strong>FIXME</strong> For now, just drop the cols that are nans (v v small fraction). in the future, would need an intelligent way of doing this</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[150]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># dcols = [col for col in df.columns if ((col.lower().startswith(&#x27;d_&#x27;)) or (col.lower().startswith(&#x27;d2_&#x27;)))]</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># X_train.drop(dcols, axis=1).isna().any().any()    # False. this means nans arise from diffs</span>\ndf <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">.</span>fillna<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">)</span>\ndf<span class=\"token\" style=\"color:#393A34\">.</span>isna<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">any</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>compute<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>[########################################] | 100% Completed |  2min  2.6s\n</span></code><pre><code><span>date                       False\nserial_number              False\ncapacity_bytes             False\nfailure                    False\nsmart_1_raw                False\n                           ...  \nd2_smart_240_normalized    False\nd_smart_241_normalized     False\nd2_smart_241_normalized    False\nd_smart_242_normalized     False\nd2_smart_242_normalized    False\nLength: 108, dtype: bool</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[151]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">dd<span class=\"token\" style=\"color:#393A34\">.</span>compute<span class=\"token\" style=\"color:#393A34\">(</span>df<span class=\"token\" style=\"color:#393A34\">.</span>shape<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>[########################################] | 100% Completed |  2min  3.9s\n</span></code><pre><code><span>((110281, 108),)</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Add Features: 6 days rolling mean, std, coefficient of variation</h2></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>The following function is an experimental version of the <code>featurize_df</code> function. It <strong>REQUIRES</strong> indices to be unique (and thus wont work with dask).</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[15]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">pandas_rolling_feats</span><span class=\"token\" style=\"color:#393A34\">(</span>df<span class=\"token\" style=\"color:#393A34\">,</span> window<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">6</span><span class=\"token\" style=\"color:#393A34\">,</span> drop_cols<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;date&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;failure&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;capacity_bytes&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;rul&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> group_cols<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> cap<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># save the status labels</span>\n    statuses <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;status&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n\n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># group by serials, drop cols which are not to be aggregated</span>\n    <span class=\"token\" style=\"color:#0000ff\">if</span> drop_cols <span class=\"token\" style=\"color:#0000ff\">is</span> <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#36acaa\">None</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        grouped_df <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">.</span>drop<span class=\"token\" style=\"color:#393A34\">(</span>drop_cols<span class=\"token\" style=\"color:#393A34\">,</span> axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>groupby<span class=\"token\" style=\"color:#393A34\">(</span>group_cols<span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        grouped_df <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">.</span>groupby<span class=\"token\" style=\"color:#393A34\">(</span>group_cols<span class=\"token\" style=\"color:#393A34\">)</span>\n        \n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># feature columns</span>\n    featcols <span class=\"token\" style=\"color:#393A34\">=</span> grouped_df<span class=\"token\" style=\"color:#393A34\">.</span>first<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>columns\n    \n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># get mean value in last 6 days</span>\n    means <span class=\"token\" style=\"color:#393A34\">=</span> grouped_df<span class=\"token\" style=\"color:#393A34\">.</span>rolling<span class=\"token\" style=\"color:#393A34\">(</span>window<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">[</span>featcols<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>mean<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    \n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># get std in last 6 days</span>\n    stds <span class=\"token\" style=\"color:#393A34\">=</span> grouped_df<span class=\"token\" style=\"color:#393A34\">.</span>rolling<span class=\"token\" style=\"color:#393A34\">(</span>window<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">[</span>featcols<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>std<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    \n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># coefficient of variation</span>\n    cvs <span class=\"token\" style=\"color:#393A34\">=</span> stds<span class=\"token\" style=\"color:#393A34\">.</span>divide<span class=\"token\" style=\"color:#393A34\">(</span>means<span class=\"token\" style=\"color:#393A34\">,</span> fill_value<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># rename before mergeing</span>\n    means <span class=\"token\" style=\"color:#393A34\">=</span> means<span class=\"token\" style=\"color:#393A34\">.</span>rename<span class=\"token\" style=\"color:#393A34\">(</span>columns<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">{</span>col<span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&#x27;mean_&#x27;</span> <span class=\"token\" style=\"color:#393A34\">+</span> col <span class=\"token\" style=\"color:#0000ff\">for</span> col <span class=\"token\" style=\"color:#0000ff\">in</span> means<span class=\"token\" style=\"color:#393A34\">.</span>columns<span class=\"token\" style=\"color:#393A34\">}</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    stds <span class=\"token\" style=\"color:#393A34\">=</span> stds<span class=\"token\" style=\"color:#393A34\">.</span>rename<span class=\"token\" style=\"color:#393A34\">(</span>columns<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">{</span>col<span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&#x27;std_&#x27;</span> <span class=\"token\" style=\"color:#393A34\">+</span> col <span class=\"token\" style=\"color:#0000ff\">for</span> col <span class=\"token\" style=\"color:#0000ff\">in</span> stds<span class=\"token\" style=\"color:#393A34\">.</span>columns<span class=\"token\" style=\"color:#393A34\">}</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    cvs <span class=\"token\" style=\"color:#393A34\">=</span> cvs<span class=\"token\" style=\"color:#393A34\">.</span>rename<span class=\"token\" style=\"color:#393A34\">(</span>columns<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">{</span>col<span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&#x27;cv_&#x27;</span> <span class=\"token\" style=\"color:#393A34\">+</span> col <span class=\"token\" style=\"color:#0000ff\">for</span> col <span class=\"token\" style=\"color:#0000ff\">in</span> cvs<span class=\"token\" style=\"color:#393A34\">.</span>columns<span class=\"token\" style=\"color:#393A34\">}</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    \n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># combine features into one df</span>\n    res <span class=\"token\" style=\"color:#393A34\">=</span> means<span class=\"token\" style=\"color:#393A34\">.</span>merge<span class=\"token\" style=\"color:#393A34\">(</span>stds<span class=\"token\" style=\"color:#393A34\">,</span> left_index<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span> right_index<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    res <span class=\"token\" style=\"color:#393A34\">=</span> res<span class=\"token\" style=\"color:#393A34\">.</span>merge<span class=\"token\" style=\"color:#393A34\">(</span>cvs<span class=\"token\" style=\"color:#393A34\">,</span> left_index<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span> right_index<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    \n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># drop rows where all columns are nans</span>\n    res <span class=\"token\" style=\"color:#393A34\">=</span> res<span class=\"token\" style=\"color:#393A34\">.</span>dropna<span class=\"token\" style=\"color:#393A34\">(</span>how<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&#x27;all&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    \n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># fill nans created by cv calculation</span>\n    res <span class=\"token\" style=\"color:#393A34\">=</span> res<span class=\"token\" style=\"color:#393A34\">.</span>fillna<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    \n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># capacity of hard drive</span>\n    <span class=\"token\" style=\"color:#0000ff\">if</span> cap<span class=\"token\" style=\"color:#393A34\">:</span>\n        capacities <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;capacity_bytes&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>groupby<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">max</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n        res <span class=\"token\" style=\"color:#393A34\">=</span> res<span class=\"token\" style=\"color:#393A34\">.</span>merge<span class=\"token\" style=\"color:#393A34\">(</span>capacities<span class=\"token\" style=\"color:#393A34\">,</span> left_index<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span> right_index<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\n        \n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># bring serial number back as a col instead of index, preserve the corresponding indices</span>\n    res <span class=\"token\" style=\"color:#393A34\">=</span> res<span class=\"token\" style=\"color:#393A34\">.</span>reset_index<span class=\"token\" style=\"color:#393A34\">(</span>level<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    \n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># add status labels back.</span>\n    res <span class=\"token\" style=\"color:#393A34\">=</span> res<span class=\"token\" style=\"color:#393A34\">.</span>merge<span class=\"token\" style=\"color:#393A34\">(</span>statuses<span class=\"token\" style=\"color:#393A34\">,</span> left_index<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span> right_index<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    \n    <span class=\"token\" style=\"color:#0000ff\">return</span> res</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[16]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># must convert dask to pandas</span>\ndf <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">.</span>compute<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># MUST make sure indices are unique before processing</span>\ndf <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">.</span>reset_index<span class=\"token\" style=\"color:#393A34\">(</span>drop<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\nfeats_df <span class=\"token\" style=\"color:#393A34\">=</span> pandas_rolling_feats<span class=\"token\" style=\"color:#393A34\">(</span>df<span class=\"token\" style=\"color:#393A34\">,</span>\n                                window<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">6</span><span class=\"token\" style=\"color:#393A34\">,</span>\n                                drop_cols<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;date&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;capacity_bytes&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;failure&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;rul_days&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;status&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span>\n                                group_cols<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>[########################################] | 100% Completed | 41.8s\n</span></code></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[17]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># infinities get added to df - remove these</span>\nfeats_df <span class=\"token\" style=\"color:#393A34\">=</span> feats_df<span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">[</span>np<span class=\"token\" style=\"color:#393A34\">.</span>inf<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#393A34\">-</span>np<span class=\"token\" style=\"color:#393A34\">.</span>inf<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> np<span class=\"token\" style=\"color:#393A34\">.</span>nan<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>dropna<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\nfeats_df<span class=\"token\" style=\"color:#393A34\">.</span>head<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>serial_number</th>\n      <th>mean_smart_1_raw</th>\n      <th>mean_smart_5_raw</th>\n      <th>mean_smart_7_raw</th>\n      <th>mean_smart_9_raw</th>\n      <th>mean_smart_10_raw</th>\n      <th>mean_smart_184_raw</th>\n      <th>mean_smart_187_raw</th>\n      <th>mean_smart_188_raw</th>\n      <th>mean_smart_189_raw</th>\n      <th>...</th>\n      <th>cv_smart_190_normalized</th>\n      <th>cv_smart_193_normalized</th>\n      <th>cv_smart_194_normalized</th>\n      <th>cv_smart_197_normalized</th>\n      <th>cv_smart_198_normalized</th>\n      <th>cv_smart_240_normalized</th>\n      <th>cv_smart_241_normalized</th>\n      <th>cv_smart_242_normalized</th>\n      <th>capacity_bytes</th>\n      <th>status</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>401298</th>\n      <td>S2ZYJ9AF511164</td>\n      <td>308.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>27845.0</td>\n      <td>0.0</td>\n      <td>-100.0</td>\n      <td>0.078777</td>\n      <td>70935512.0</td>\n      <td>-100.0</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>-0.0</td>\n      <td>-0.0</td>\n      <td>-0.0</td>\n      <td>5.001079e+11</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>401299</th>\n      <td>S2ZYJ9AF511164</td>\n      <td>308.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>27845.0</td>\n      <td>0.0</td>\n      <td>-100.0</td>\n      <td>0.078777</td>\n      <td>70935512.0</td>\n      <td>-100.0</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>-0.0</td>\n      <td>-0.0</td>\n      <td>-0.0</td>\n      <td>5.001079e+11</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>401300</th>\n      <td>S2ZYJ9AF511164</td>\n      <td>308.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>27845.0</td>\n      <td>0.0</td>\n      <td>-100.0</td>\n      <td>0.078777</td>\n      <td>70935512.0</td>\n      <td>-100.0</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>-0.0</td>\n      <td>-0.0</td>\n      <td>-0.0</td>\n      <td>5.001079e+11</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>401301</th>\n      <td>S2ZYJ9AF511164</td>\n      <td>308.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>27845.0</td>\n      <td>0.0</td>\n      <td>-100.0</td>\n      <td>0.078777</td>\n      <td>70935512.0</td>\n      <td>-100.0</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>-0.0</td>\n      <td>-0.0</td>\n      <td>-0.0</td>\n      <td>5.001079e+11</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>401302</th>\n      <td>S2ZYJ9AF511164</td>\n      <td>308.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>27845.0</td>\n      <td>0.0</td>\n      <td>-100.0</td>\n      <td>0.078777</td>\n      <td>70935512.0</td>\n      <td>-100.0</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>-0.0</td>\n      <td>-0.0</td>\n      <td>-0.0</td>\n      <td>5.001079e+11</td>\n      <td>0</td>\n    </tr>\n  </tbody>\n</table>\n<p>5 rows Ã— 105 columns</p>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Drive-wise Split Data</h2></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[18]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">from</span> sklearn<span class=\"token\" style=\"color:#393A34\">.</span>utils<span class=\"token\" style=\"color:#393A34\">.</span>class_weight <span class=\"token\" style=\"color:#0000ff\">import</span> compute_class_weight\n<span class=\"token\" style=\"color:#0000ff\">from</span> sklearn<span class=\"token\" style=\"color:#393A34\">.</span>model_selection <span class=\"token\" style=\"color:#0000ff\">import</span> train_test_split\n\n<span class=\"token\" style=\"color:#0000ff\">from</span> dask_ml<span class=\"token\" style=\"color:#393A34\">.</span>preprocessing <span class=\"token\" style=\"color:#0000ff\">import</span> RobustScaler <span class=\"token\" style=\"color:#0000ff\">as</span> ddRobustScaler\n<span class=\"token\" style=\"color:#0000ff\">from</span> dask_ml<span class=\"token\" style=\"color:#393A34\">.</span>preprocessing <span class=\"token\" style=\"color:#0000ff\">import</span> StandardScaler <span class=\"token\" style=\"color:#0000ff\">as</span> ddStandardScaler\n<span class=\"token\" style=\"color:#0000ff\">from</span> dask_ml<span class=\"token\" style=\"color:#393A34\">.</span>model_selection <span class=\"token\" style=\"color:#0000ff\">import</span> train_test_split <span class=\"token\" style=\"color:#0000ff\">as</span> ddtrain_test_split</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[19]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># [&#x27;date&#x27;, &#x27;serial_number&#x27;, &#x27;model&#x27;, &#x27;failure&#x27;, &#x27;rul_days&#x27;, &#x27;status&#x27;]</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># [&#x27;serial_number&#x27;, &#x27;status&#x27;]</span>\nX_arr <span class=\"token\" style=\"color:#393A34\">=</span> feats_df<span class=\"token\" style=\"color:#393A34\">.</span>drop<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;status&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span>\nY_arr <span class=\"token\" style=\"color:#393A34\">=</span> feats_df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;status&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">]</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[20]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># failed serials left after reduction</span>\nfailed_sers_red <span class=\"token\" style=\"color:#393A34\">=</span> pd<span class=\"token\" style=\"color:#393A34\">.</span>Series<span class=\"token\" style=\"color:#393A34\">(</span>Y_arr<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>unique<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\nfailed_sers_red <span class=\"token\" style=\"color:#393A34\">=</span> failed_sers_red<span class=\"token\" style=\"color:#393A34\">[</span>failed_sers_red<span class=\"token\" style=\"color:#393A34\">.</span>isin<span class=\"token\" style=\"color:#393A34\">(</span>failed_serials<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># working serials left after reduction</span>\nworking_sers_red <span class=\"token\" style=\"color:#393A34\">=</span> pd<span class=\"token\" style=\"color:#393A34\">.</span>Series<span class=\"token\" style=\"color:#393A34\">(</span>Y_arr<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>unique<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\nworking_sers_red <span class=\"token\" style=\"color:#393A34\">=</span> working_sers_red<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">~</span>working_sers_red<span class=\"token\" style=\"color:#393A34\">.</span>isin<span class=\"token\" style=\"color:#393A34\">(</span>failed_serials<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># split working and failed</span>\nworking_train<span class=\"token\" style=\"color:#393A34\">,</span> working_test <span class=\"token\" style=\"color:#393A34\">=</span> train_test_split<span class=\"token\" style=\"color:#393A34\">(</span>working_sers_red<span class=\"token\" style=\"color:#393A34\">,</span> test_size<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0.2</span><span class=\"token\" style=\"color:#393A34\">,</span> random_state<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">42</span><span class=\"token\" style=\"color:#393A34\">)</span>\nfailed_train<span class=\"token\" style=\"color:#393A34\">,</span> failed_test <span class=\"token\" style=\"color:#393A34\">=</span> train_test_split<span class=\"token\" style=\"color:#393A34\">(</span>failed_sers_red<span class=\"token\" style=\"color:#393A34\">,</span> test_size<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0.2</span><span class=\"token\" style=\"color:#393A34\">,</span> random_state<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">42</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[21]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># use serial numbers to generate train/test set</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># CHECKED OK - train/test ratio 0.8, fail/work and overall both</span>\nX_train_work <span class=\"token\" style=\"color:#393A34\">=</span> X_arr<span class=\"token\" style=\"color:#393A34\">[</span>Y_arr<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>isin<span class=\"token\" style=\"color:#393A34\">(</span>working_train<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span>\nX_train_fail <span class=\"token\" style=\"color:#393A34\">=</span> X_arr<span class=\"token\" style=\"color:#393A34\">[</span>Y_arr<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>isin<span class=\"token\" style=\"color:#393A34\">(</span>failed_train<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span>\nX_train <span class=\"token\" style=\"color:#393A34\">=</span> pd<span class=\"token\" style=\"color:#393A34\">.</span>concat<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">[</span>X_train_work<span class=\"token\" style=\"color:#393A34\">,</span> X_train_fail<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\nY_train_work <span class=\"token\" style=\"color:#393A34\">=</span> Y_arr<span class=\"token\" style=\"color:#393A34\">[</span>Y_arr<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>isin<span class=\"token\" style=\"color:#393A34\">(</span>working_train<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;status&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\nY_train_fail <span class=\"token\" style=\"color:#393A34\">=</span> Y_arr<span class=\"token\" style=\"color:#393A34\">[</span>Y_arr<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>isin<span class=\"token\" style=\"color:#393A34\">(</span>failed_train<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;status&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\nY_train <span class=\"token\" style=\"color:#393A34\">=</span> pd<span class=\"token\" style=\"color:#393A34\">.</span>concat<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">[</span>Y_train_work<span class=\"token\" style=\"color:#393A34\">,</span> Y_train_fail<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\nX_test_work <span class=\"token\" style=\"color:#393A34\">=</span> X_arr<span class=\"token\" style=\"color:#393A34\">[</span>Y_arr<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>isin<span class=\"token\" style=\"color:#393A34\">(</span>working_test<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span>\nX_test_fail <span class=\"token\" style=\"color:#393A34\">=</span> X_arr<span class=\"token\" style=\"color:#393A34\">[</span>Y_arr<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>isin<span class=\"token\" style=\"color:#393A34\">(</span>failed_test<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span>\nX_test <span class=\"token\" style=\"color:#393A34\">=</span> pd<span class=\"token\" style=\"color:#393A34\">.</span>concat<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">[</span>X_test_work<span class=\"token\" style=\"color:#393A34\">,</span> X_test_fail<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\nY_test_work <span class=\"token\" style=\"color:#393A34\">=</span> Y_arr<span class=\"token\" style=\"color:#393A34\">[</span>Y_arr<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>isin<span class=\"token\" style=\"color:#393A34\">(</span>working_test<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;status&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\nY_test_fail <span class=\"token\" style=\"color:#393A34\">=</span> Y_arr<span class=\"token\" style=\"color:#393A34\">[</span>Y_arr<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;serial_number&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>isin<span class=\"token\" style=\"color:#393A34\">(</span>failed_test<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;status&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\nY_test <span class=\"token\" style=\"color:#393A34\">=</span> pd<span class=\"token\" style=\"color:#393A34\">.</span>concat<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">[</span>Y_test_work<span class=\"token\" style=\"color:#393A34\">,</span> Y_test_fail<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[22]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># verufy proportions</span>\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>X_train_fail<span class=\"token\" style=\"color:#393A34\">.</span>shape<span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>X_test_fail<span class=\"token\" style=\"color:#393A34\">.</span>shape<span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>X_train_work<span class=\"token\" style=\"color:#393A34\">.</span>shape<span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>X_test_work<span class=\"token\" style=\"color:#393A34\">.</span>shape<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>(42373, 103)\n(10108, 103)\n(472593, 103)\n(117458, 103)\n</span></code></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Scale</h2></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[23]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">from</span> sklearn<span class=\"token\" style=\"color:#393A34\">.</span>preprocessing <span class=\"token\" style=\"color:#0000ff\">import</span> StandardScaler<span class=\"token\" style=\"color:#393A34\">,</span> RobustScaler\n<span class=\"token\" style=\"color:#0000ff\">from</span> sklearn<span class=\"token\" style=\"color:#393A34\">.</span>model_selection <span class=\"token\" style=\"color:#0000ff\">import</span> train_test_split</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[24]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># robust scaling to not be outlier sensitive</span>\nscaler <span class=\"token\" style=\"color:#393A34\">=</span> RobustScaler<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\nX_train <span class=\"token\" style=\"color:#393A34\">=</span> scaler<span class=\"token\" style=\"color:#393A34\">.</span>fit_transform<span class=\"token\" style=\"color:#393A34\">(</span>X_train<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[25]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># FIXME: this would not work for dask objects (delayed objects) - MUST use cloudpickle for that</span>\nfname <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&#x27;../models/{}_preprocessor_{}.joblib&#x27;</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">format</span><span class=\"token\" style=\"color:#393A34\">(</span>MANUFACTURER<span class=\"token\" style=\"color:#393A34\">,</span> datetime<span class=\"token\" style=\"color:#393A34\">.</span>datetime<span class=\"token\" style=\"color:#393A34\">.</span>now<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>strftime<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;%b_%d_%Y_%H_%M_%S&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\njoblib<span class=\"token\" style=\"color:#393A34\">.</span>dump<span class=\"token\" style=\"color:#393A34\">(</span>scaler<span class=\"token\" style=\"color:#393A34\">,</span> fname<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>[&#x27;../models/seagate_preprocessor_Sep_03_2019_13_14_49.joblib&#x27;]</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Establish Baseline</h2></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>What would a baseline multiclass classifier look like? This can be found using a naive approach where drives are classified purely based on predefined/inferred thresholds.</p>\n<p>Thresholds can be set in a variety of ways. A simple and naive way would be to involve all the covariates to determine the threshold boundary using their mean, or std, or max, or min values. Then, based some distance metric, drive can be classified.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[40]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># use mean values as threshold</span>\nclass0_mean <span class=\"token\" style=\"color:#393A34\">=</span> X_train<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">(</span>Y_train<span class=\"token\" style=\"color:#393A34\">==</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>values<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>mean<span class=\"token\" style=\"color:#393A34\">(</span>axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\nclass1_mean <span class=\"token\" style=\"color:#393A34\">=</span> X_train<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">(</span>Y_train<span class=\"token\" style=\"color:#393A34\">==</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>values<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>mean<span class=\"token\" style=\"color:#393A34\">(</span>axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\nclass2_mean <span class=\"token\" style=\"color:#393A34\">=</span> X_train<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">(</span>Y_train<span class=\"token\" style=\"color:#393A34\">==</span><span class=\"token\" style=\"color:#36acaa\">2</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>values<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>mean<span class=\"token\" style=\"color:#393A34\">(</span>axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\nclass_means <span class=\"token\" style=\"color:#393A34\">=</span> np<span class=\"token\" style=\"color:#393A34\">.</span>vstack<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">(</span>class0_mean<span class=\"token\" style=\"color:#393A34\">,</span> class1_mean<span class=\"token\" style=\"color:#393A34\">,</span> class2_mean<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># predict based on a distance metric from mean values</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># NOTE: canberra, cosine generally work better than l2,l1,etc</span>\npreds <span class=\"token\" style=\"color:#393A34\">=</span> pairwise_distances_argmin<span class=\"token\" style=\"color:#393A34\">(</span>scaler<span class=\"token\" style=\"color:#393A34\">.</span>transform<span class=\"token\" style=\"color:#393A34\">(</span>X_test<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> class_means<span class=\"token\" style=\"color:#393A34\">,</span> metric<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&#x27;canberra&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># how does the baseline look</span>\ncm <span class=\"token\" style=\"color:#393A34\">=</span> confusion_matrix<span class=\"token\" style=\"color:#393A34\">(</span>Y_test<span class=\"token\" style=\"color:#393A34\">,</span> preds<span class=\"token\" style=\"color:#393A34\">)</span>\ncm\ncm <span class=\"token\" style=\"color:#393A34\">/</span> cm<span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">sum</span><span class=\"token\" style=\"color:#393A34\">(</span>axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>array([[26593, 55425, 40595],\n       [  625,  1091,  1041],\n       [  285,   635,   669]])</span></code></pre><pre><code><span>array([[0.21688565, 0.452032  , 0.33108235],\n       [0.22669568, 0.39571999, 0.37758433],\n       [0.17935809, 0.3996224 , 0.42101951]])</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[41]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># use median values as threshold</span>\nclass0_median <span class=\"token\" style=\"color:#393A34\">=</span> np<span class=\"token\" style=\"color:#393A34\">.</span>median<span class=\"token\" style=\"color:#393A34\">(</span>X_train<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">(</span>Y_train<span class=\"token\" style=\"color:#393A34\">==</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>values<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\nclass1_median <span class=\"token\" style=\"color:#393A34\">=</span> np<span class=\"token\" style=\"color:#393A34\">.</span>median<span class=\"token\" style=\"color:#393A34\">(</span>X_train<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">(</span>Y_train<span class=\"token\" style=\"color:#393A34\">==</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>values<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\nclass2_median <span class=\"token\" style=\"color:#393A34\">=</span> np<span class=\"token\" style=\"color:#393A34\">.</span>median<span class=\"token\" style=\"color:#393A34\">(</span>X_train<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">(</span>Y_train<span class=\"token\" style=\"color:#393A34\">==</span><span class=\"token\" style=\"color:#36acaa\">2</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>values<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\nclass_medians <span class=\"token\" style=\"color:#393A34\">=</span> np<span class=\"token\" style=\"color:#393A34\">.</span>vstack<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">(</span>class0_median<span class=\"token\" style=\"color:#393A34\">,</span> class1_median<span class=\"token\" style=\"color:#393A34\">,</span> class2_median<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># predict based on a distance metric from median values</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># NOTE: canberra, cosine generally work better than l2,l1,etc</span>\npreds <span class=\"token\" style=\"color:#393A34\">=</span> pairwise_distances_argmin<span class=\"token\" style=\"color:#393A34\">(</span>scaler<span class=\"token\" style=\"color:#393A34\">.</span>transform<span class=\"token\" style=\"color:#393A34\">(</span>X_test<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> class_medians<span class=\"token\" style=\"color:#393A34\">,</span> metric<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&#x27;canberra&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># how does the baseline look</span>\ncm <span class=\"token\" style=\"color:#393A34\">=</span> confusion_matrix<span class=\"token\" style=\"color:#393A34\">(</span>Y_test<span class=\"token\" style=\"color:#393A34\">,</span> preds<span class=\"token\" style=\"color:#393A34\">)</span>\ncm\ncm <span class=\"token\" style=\"color:#393A34\">/</span> cm<span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">sum</span><span class=\"token\" style=\"color:#393A34\">(</span>axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>array([[  2185,  16991, 103437],\n       [    51,    335,   2371],\n       [    14,    187,   1388]])</span></code></pre><pre><code><span>array([[0.0178203 , 0.13857421, 0.84360549],\n       [0.01849837, 0.12150889, 0.85999275],\n       [0.00881057, 0.11768408, 0.87350535]])</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[42]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># use min values as threshold</span>\nclass0_min <span class=\"token\" style=\"color:#393A34\">=</span> X_train<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">(</span>Y_train<span class=\"token\" style=\"color:#393A34\">==</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>values<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">min</span><span class=\"token\" style=\"color:#393A34\">(</span>axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\nclass1_min <span class=\"token\" style=\"color:#393A34\">=</span> X_train<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">(</span>Y_train<span class=\"token\" style=\"color:#393A34\">==</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>values<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">min</span><span class=\"token\" style=\"color:#393A34\">(</span>axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\nclass2_min <span class=\"token\" style=\"color:#393A34\">=</span> X_train<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">(</span>Y_train<span class=\"token\" style=\"color:#393A34\">==</span><span class=\"token\" style=\"color:#36acaa\">2</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>values<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">min</span><span class=\"token\" style=\"color:#393A34\">(</span>axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\nclass_mins <span class=\"token\" style=\"color:#393A34\">=</span> np<span class=\"token\" style=\"color:#393A34\">.</span>vstack<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">(</span>class0_min<span class=\"token\" style=\"color:#393A34\">,</span> class1_min<span class=\"token\" style=\"color:#393A34\">,</span> class2_min<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># predict based on a distance metric from min values</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># NOTE: canberra, cosine generally work better than l2,l1,etc</span>\npreds <span class=\"token\" style=\"color:#393A34\">=</span> pairwise_distances_argmin<span class=\"token\" style=\"color:#393A34\">(</span>scaler<span class=\"token\" style=\"color:#393A34\">.</span>transform<span class=\"token\" style=\"color:#393A34\">(</span>X_test<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> class_mins<span class=\"token\" style=\"color:#393A34\">,</span> metric<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&#x27;cosine&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># how does the baseline look</span>\ncm <span class=\"token\" style=\"color:#393A34\">=</span> confusion_matrix<span class=\"token\" style=\"color:#393A34\">(</span>Y_test<span class=\"token\" style=\"color:#393A34\">,</span> preds<span class=\"token\" style=\"color:#393A34\">)</span>\ncm\ncm <span class=\"token\" style=\"color:#393A34\">/</span> cm<span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">sum</span><span class=\"token\" style=\"color:#393A34\">(</span>axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>array([[40628, 25678, 56307],\n       [  732,   842,  1183],\n       [  504,   551,   534]])</span></code></pre><pre><code><span>array([[0.33135149, 0.20942314, 0.45922537],\n       [0.26550598, 0.30540443, 0.42908959],\n       [0.31718062, 0.34675897, 0.33606042]])</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[43]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># use max values as threshold</span>\nclass0_max <span class=\"token\" style=\"color:#393A34\">=</span> X_train<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">(</span>Y_train<span class=\"token\" style=\"color:#393A34\">==</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>values<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">max</span><span class=\"token\" style=\"color:#393A34\">(</span>axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\nclass1_max <span class=\"token\" style=\"color:#393A34\">=</span> X_train<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">(</span>Y_train<span class=\"token\" style=\"color:#393A34\">==</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>values<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">max</span><span class=\"token\" style=\"color:#393A34\">(</span>axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\nclass2_max <span class=\"token\" style=\"color:#393A34\">=</span> X_train<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">(</span>Y_train<span class=\"token\" style=\"color:#393A34\">==</span><span class=\"token\" style=\"color:#36acaa\">2</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>values<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">max</span><span class=\"token\" style=\"color:#393A34\">(</span>axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\nclass_maxs <span class=\"token\" style=\"color:#393A34\">=</span> np<span class=\"token\" style=\"color:#393A34\">.</span>vstack<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">(</span>class0_max<span class=\"token\" style=\"color:#393A34\">,</span> class1_max<span class=\"token\" style=\"color:#393A34\">,</span> class2_max<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># predict based on a distance metric from max values</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># NOTE: canberra, cosine generally work better than l2,l1,etc</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># preds = pairwise_distances_argmin(X_test, class_maxs, metric=&#x27;cosine&#x27;)</span>\nclass0_confs <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">(</span>scaler<span class=\"token\" style=\"color:#393A34\">.</span>transform<span class=\"token\" style=\"color:#393A34\">(</span>X_test<span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">&gt;</span> class0_max<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">sum</span><span class=\"token\" style=\"color:#393A34\">(</span>axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\nclass1_confs <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">(</span>scaler<span class=\"token\" style=\"color:#393A34\">.</span>transform<span class=\"token\" style=\"color:#393A34\">(</span>X_test<span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">&gt;</span> class1_max<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">sum</span><span class=\"token\" style=\"color:#393A34\">(</span>axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\nclass2_confs <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">(</span>scaler<span class=\"token\" style=\"color:#393A34\">.</span>transform<span class=\"token\" style=\"color:#393A34\">(</span>X_test<span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">&gt;</span> class2_max<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">sum</span><span class=\"token\" style=\"color:#393A34\">(</span>axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\nclass_confs <span class=\"token\" style=\"color:#393A34\">=</span> np<span class=\"token\" style=\"color:#393A34\">.</span>hstack<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">(</span>class0_confs<span class=\"token\" style=\"color:#393A34\">,</span> class1_confs<span class=\"token\" style=\"color:#393A34\">,</span> class2_confs<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\npreds <span class=\"token\" style=\"color:#393A34\">=</span> np<span class=\"token\" style=\"color:#393A34\">.</span>argmax<span class=\"token\" style=\"color:#393A34\">(</span>class_confs<span class=\"token\" style=\"color:#393A34\">,</span> axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># how does the baseline look</span>\ncm <span class=\"token\" style=\"color:#393A34\">=</span> confusion_matrix<span class=\"token\" style=\"color:#393A34\">(</span>Y_test<span class=\"token\" style=\"color:#393A34\">,</span> preds<span class=\"token\" style=\"color:#393A34\">)</span>\ncm\ncm <span class=\"token\" style=\"color:#393A34\">/</span> cm<span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">sum</span><span class=\"token\" style=\"color:#393A34\">(</span>axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>array([[120093,   1826,    694],\n       [  2715,     31,     11],\n       [  1524,     55,     10]])</span></code></pre><pre><code><span>array([[0.97944753, 0.01489238, 0.00566008],\n       [0.98476605, 0.01124411, 0.00398984],\n       [0.95909377, 0.03461296, 0.00629327]])</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Train</h2></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p><strong>NOTE</strong> As of today (September 3, 2019) it is difficult to integrate into Ceph models built using python libraries that are not rpm or deb packaged.<br/>\nTherefore RGF and XGBoost just serve as comparisons as opposed to models that can be actually used in upstream Ceph today</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[26]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># training is going to require a lot of memory. free as much as possible</span>\n<span class=\"token\" style=\"color:#0000ff\">del</span> df\n<span class=\"token\" style=\"color:#0000ff\">del</span> feats_df\n<span class=\"token\" style=\"color:#0000ff\">del</span> X_train_work\n<span class=\"token\" style=\"color:#0000ff\">del</span> X_train_fail\n<span class=\"token\" style=\"color:#0000ff\">del</span> Y_train_work\n<span class=\"token\" style=\"color:#0000ff\">del</span> Y_train_fail\n<span class=\"token\" style=\"color:#0000ff\">del</span> X_test_work\n<span class=\"token\" style=\"color:#0000ff\">del</span> X_test_fail\n<span class=\"token\" style=\"color:#0000ff\">del</span> Y_test_work\n<span class=\"token\" style=\"color:#0000ff\">del</span> Y_test_fail\ngc<span class=\"token\" style=\"color:#393A34\">.</span>collect<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>182</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h3>Vanilla Decision Tree</h3></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[27]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">from</span> sklearn<span class=\"token\" style=\"color:#393A34\">.</span>tree <span class=\"token\" style=\"color:#0000ff\">import</span> DecisionTreeClassifier<span class=\"token\" style=\"color:#393A34\">,</span> export_graphviz</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[28]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># with joblib.parallel_backend(&#x27;dask&#x27;):</span>\ndt_clf <span class=\"token\" style=\"color:#393A34\">=</span> DecisionTreeClassifier<span class=\"token\" style=\"color:#393A34\">(</span>random_state<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">24</span><span class=\"token\" style=\"color:#393A34\">)</span>\ndt_clf<span class=\"token\" style=\"color:#393A34\">.</span>fit<span class=\"token\" style=\"color:#393A34\">(</span>X_train<span class=\"token\" style=\"color:#393A34\">,</span> Y_train<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>DecisionTreeClassifier(class_weight=None, criterion=&#x27;gini&#x27;, max_depth=None,\n                       max_features=None, max_leaf_nodes=None,\n                       min_impurity_decrease=0.0, min_impurity_split=None,\n                       min_samples_leaf=1, min_samples_split=2,\n                       min_weight_fraction_leaf=0.0, presort=False,\n                       random_state=24, splitter=&#x27;best&#x27;)</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[29]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># with joblib.parallel_backend(&#x27;dask&#x27;):</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># get preds</span>\ndt_preds <span class=\"token\" style=\"color:#393A34\">=</span> dt_clf<span class=\"token\" style=\"color:#393A34\">.</span>predict<span class=\"token\" style=\"color:#393A34\">(</span>scaler<span class=\"token\" style=\"color:#393A34\">.</span>transform<span class=\"token\" style=\"color:#393A34\">(</span>X_test<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\ndt_confmat <span class=\"token\" style=\"color:#393A34\">=</span> confusion_matrix<span class=\"token\" style=\"color:#393A34\">(</span>Y_test<span class=\"token\" style=\"color:#393A34\">,</span> dt_preds<span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>dt_confmat<span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>classification_report<span class=\"token\" style=\"color:#393A34\">(</span>Y_test<span class=\"token\" style=\"color:#393A34\">,</span> dt_preds<span class=\"token\" style=\"color:#393A34\">,</span> target_names<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;good&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;warning&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;bad&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>[[119369   1797   2068]\n [  2137    272    343]\n [  1007    222    351]]\n              precision    recall  f1-score   support\n\n        good       0.97      0.97      0.97    123234\n     warning       0.12      0.10      0.11      2752\n         bad       0.13      0.22      0.16      1580\n\n    accuracy                           0.94    127566\n   macro avg       0.41      0.43      0.41    127566\nweighted avg       0.95      0.94      0.94    127566\n\n</span></code></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[30]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># FIXME: this would not work for dask objects (delayed objects) - MUST use cloudpickle for that</span>\nfname <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&#x27;../models/{}_predictor_dt_{}.joblib&#x27;</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">format</span><span class=\"token\" style=\"color:#393A34\">(</span>MANUFACTURER<span class=\"token\" style=\"color:#393A34\">,</span> datetime<span class=\"token\" style=\"color:#393A34\">.</span>datetime<span class=\"token\" style=\"color:#393A34\">.</span>now<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>strftime<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;%b_%d_%Y_%H_%M_%S&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\njoblib<span class=\"token\" style=\"color:#393A34\">.</span>dump<span class=\"token\" style=\"color:#393A34\">(</span>dt_clf<span class=\"token\" style=\"color:#393A34\">,</span> fname<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>[&#x27;../models/seagate_predictor_dt_Sep_03_2019_13_15_26.joblib&#x27;]</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h3>Vanilla Random Forest</h3></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[31]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">from</span> sklearn<span class=\"token\" style=\"color:#393A34\">.</span>ensemble <span class=\"token\" style=\"color:#0000ff\">import</span> RandomForestClassifier</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[32]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">rf_clf <span class=\"token\" style=\"color:#393A34\">=</span> RandomForestClassifier<span class=\"token\" style=\"color:#393A34\">(</span>n_estimators<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">12</span><span class=\"token\" style=\"color:#393A34\">,</span> class_weight<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&#x27;balanced&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> n_jobs<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">-</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">,</span> random_state<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">24</span><span class=\"token\" style=\"color:#393A34\">)</span>\nrf_clf<span class=\"token\" style=\"color:#393A34\">.</span>fit<span class=\"token\" style=\"color:#393A34\">(</span>X_train<span class=\"token\" style=\"color:#393A34\">,</span> Y_train<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>RandomForestClassifier(bootstrap=True, class_weight=&#x27;balanced&#x27;,\n                       criterion=&#x27;gini&#x27;, max_depth=None, max_features=&#x27;auto&#x27;,\n                       max_leaf_nodes=None, min_impurity_decrease=0.0,\n                       min_impurity_split=None, min_samples_leaf=1,\n                       min_samples_split=2, min_weight_fraction_leaf=0.0,\n                       n_estimators=12, n_jobs=-1, oob_score=False,\n                       random_state=24, verbose=0, warm_start=False)</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[33]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># get preds</span>\nrf_preds <span class=\"token\" style=\"color:#393A34\">=</span> rf_clf<span class=\"token\" style=\"color:#393A34\">.</span>predict<span class=\"token\" style=\"color:#393A34\">(</span>scaler<span class=\"token\" style=\"color:#393A34\">.</span>transform<span class=\"token\" style=\"color:#393A34\">(</span>X_test<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\nrf_confmat <span class=\"token\" style=\"color:#393A34\">=</span> confusion_matrix<span class=\"token\" style=\"color:#393A34\">(</span>Y_test<span class=\"token\" style=\"color:#393A34\">,</span> rf_preds<span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>rf_confmat<span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>classification_report<span class=\"token\" style=\"color:#393A34\">(</span>Y_test<span class=\"token\" style=\"color:#393A34\">,</span> rf_preds<span class=\"token\" style=\"color:#393A34\">,</span> target_names<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;good&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;warning&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;bad&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>[[122948    174    112]\n [  2545     87    120]\n [  1290     62    228]]\n              precision    recall  f1-score   support\n\n        good       0.97      1.00      0.98    123234\n     warning       0.27      0.03      0.06      2752\n         bad       0.50      0.14      0.22      1580\n\n    accuracy                           0.97    127566\n   macro avg       0.58      0.39      0.42    127566\nweighted avg       0.95      0.97      0.95    127566\n\n</span></code></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[34]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># FIXME: this would not work for dask objects (delayed objects) - MUST use cloudpickle for that</span>\nfname <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&#x27;../models/{}_predictor_rf_{}.joblib&#x27;</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">format</span><span class=\"token\" style=\"color:#393A34\">(</span>MANUFACTURER<span class=\"token\" style=\"color:#393A34\">,</span> datetime<span class=\"token\" style=\"color:#393A34\">.</span>datetime<span class=\"token\" style=\"color:#393A34\">.</span>now<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>strftime<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;%b_%d_%Y_%H_%M_%S&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\njoblib<span class=\"token\" style=\"color:#393A34\">.</span>dump<span class=\"token\" style=\"color:#393A34\">(</span>dt_clf<span class=\"token\" style=\"color:#393A34\">,</span> fname<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>[&#x27;../models/seagate_predictor_rf_Sep_03_2019_13_15_34.joblib&#x27;]</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h3>SVM</h3></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[74]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">from</span> sklearn<span class=\"token\" style=\"color:#393A34\">.</span>svm <span class=\"token\" style=\"color:#0000ff\">import</span> SVC</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[ ]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">svc <span class=\"token\" style=\"color:#393A34\">=</span> SVC<span class=\"token\" style=\"color:#393A34\">(</span>class_weight<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&#x27;balanced&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nsvc<span class=\"token\" style=\"color:#393A34\">.</span>fit<span class=\"token\" style=\"color:#393A34\">(</span>X_train<span class=\"token\" style=\"color:#393A34\">,</span> Y_train<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[ ]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># get preds</span>\nsvc_preds <span class=\"token\" style=\"color:#393A34\">=</span> svc<span class=\"token\" style=\"color:#393A34\">.</span>predict<span class=\"token\" style=\"color:#393A34\">(</span>scaler<span class=\"token\" style=\"color:#393A34\">.</span>transform<span class=\"token\" style=\"color:#393A34\">(</span>X_test<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\nsvc_confmat <span class=\"token\" style=\"color:#393A34\">=</span> confusion_matrix<span class=\"token\" style=\"color:#393A34\">(</span>Y_test<span class=\"token\" style=\"color:#393A34\">,</span> svc_preds<span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>svc_confmat<span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>classification_report<span class=\"token\" style=\"color:#393A34\">(</span>Y_test<span class=\"token\" style=\"color:#393A34\">,</span> svc_preds<span class=\"token\" style=\"color:#393A34\">,</span> target_names<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;good&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;warning&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;bad&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h3>MLP</h3></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[83]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">from</span> dask_ml<span class=\"token\" style=\"color:#393A34\">.</span>wrappers <span class=\"token\" style=\"color:#0000ff\">import</span> Incremental\n<span class=\"token\" style=\"color:#0000ff\">from</span> sklearn<span class=\"token\" style=\"color:#393A34\">.</span>neural_network <span class=\"token\" style=\"color:#0000ff\">import</span> MLPClassifier</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[ ]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">mlp <span class=\"token\" style=\"color:#393A34\">=</span> MLPClassifier<span class=\"token\" style=\"color:#393A34\">(</span>hidden_layer_sizes<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#36acaa\">128</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">512</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">512</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">128</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span>\n                    activation<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&#x27;sigmoid&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n                    batch_size<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">256</span><span class=\"token\" style=\"color:#393A34\">,</span>\n                    warm_start<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span>\n                    random_state<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">24</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># clf = Incremental(mlp)</span>\nmlp<span class=\"token\" style=\"color:#393A34\">.</span>fit<span class=\"token\" style=\"color:#393A34\">(</span>X_train<span class=\"token\" style=\"color:#393A34\">,</span> Y_train<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[ ]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># with parallel_backend(&#x27;dask&#x27;):</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># get preds</span>\nmlp_preds <span class=\"token\" style=\"color:#393A34\">=</span> mlp<span class=\"token\" style=\"color:#393A34\">.</span>predict<span class=\"token\" style=\"color:#393A34\">(</span>scaler<span class=\"token\" style=\"color:#393A34\">.</span>transform<span class=\"token\" style=\"color:#393A34\">(</span>X_test<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\nmlp_confmat <span class=\"token\" style=\"color:#393A34\">=</span> confusion_matrix<span class=\"token\" style=\"color:#393A34\">(</span>Y_test<span class=\"token\" style=\"color:#393A34\">,</span> mlp_preds<span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>np<span class=\"token\" style=\"color:#393A34\">.</span>around<span class=\"token\" style=\"color:#393A34\">(</span>mlp_confmat <span class=\"token\" style=\"color:#393A34\">/</span> mlp_confmat<span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">sum</span><span class=\"token\" style=\"color:#393A34\">(</span>axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> decimals<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">2</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>classification_report<span class=\"token\" style=\"color:#393A34\">(</span>Y_test<span class=\"token\" style=\"color:#393A34\">,</span> mlp_preds<span class=\"token\" style=\"color:#393A34\">,</span> target_names<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;good&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;warning&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;bad&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h3>RGF (depracated due to dependency issues)</h3></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[ ]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">from</span> rgf<span class=\"token\" style=\"color:#393A34\">.</span>sklearn <span class=\"token\" style=\"color:#0000ff\">import</span> RGFClassifier</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[ ]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># with parallel_backend(&#x27;dask&#x27;):</span>\nrgf_clf <span class=\"token\" style=\"color:#393A34\">=</span> RGFClassifier<span class=\"token\" style=\"color:#393A34\">(</span>max_leaf<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">2500</span><span class=\"token\" style=\"color:#393A34\">,</span> l2<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1e</span><span class=\"token\" style=\"color:#393A34\">-</span><span class=\"token\" style=\"color:#36acaa\">12</span><span class=\"token\" style=\"color:#393A34\">,</span> learning_rate<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0.01</span><span class=\"token\" style=\"color:#393A34\">)</span>\nrgf_clf<span class=\"token\" style=\"color:#393A34\">.</span>fit<span class=\"token\" style=\"color:#393A34\">(</span>X_train<span class=\"token\" style=\"color:#393A34\">,</span> Y_train<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[ ]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># get preds</span>\nrgf_preds <span class=\"token\" style=\"color:#393A34\">=</span> rgf_clf<span class=\"token\" style=\"color:#393A34\">.</span>predict<span class=\"token\" style=\"color:#393A34\">(</span>scaler<span class=\"token\" style=\"color:#393A34\">.</span>transform<span class=\"token\" style=\"color:#393A34\">(</span>X_test<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\nrgf_confmat <span class=\"token\" style=\"color:#393A34\">=</span> confusion_matrix<span class=\"token\" style=\"color:#393A34\">(</span>Y_test<span class=\"token\" style=\"color:#393A34\">,</span> rgf_preds<span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>np<span class=\"token\" style=\"color:#393A34\">.</span>around<span class=\"token\" style=\"color:#393A34\">(</span>rgf_confmat <span class=\"token\" style=\"color:#393A34\">/</span> rgf_confmat<span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">sum</span><span class=\"token\" style=\"color:#393A34\">(</span>axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> decimals<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">2</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>classification_report<span class=\"token\" style=\"color:#393A34\">(</span>Y_test<span class=\"token\" style=\"color:#393A34\">,</span> rgf_preds<span class=\"token\" style=\"color:#393A34\">,</span> target_names<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;good&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;warning&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;bad&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h3>XGBoost (depracated due to dependency issues)</h3></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[78]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">from</span> xgboost <span class=\"token\" style=\"color:#0000ff\">import</span> XGBClassifier</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[ ]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">xgb_clf <span class=\"token\" style=\"color:#393A34\">=</span> XGBClassifier<span class=\"token\" style=\"color:#393A34\">(</span>max_depth<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">8</span><span class=\"token\" style=\"color:#393A34\">,</span> n_jobs<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">8</span><span class=\"token\" style=\"color:#393A34\">)</span>\nxgb_clf<span class=\"token\" style=\"color:#393A34\">.</span>fit<span class=\"token\" style=\"color:#393A34\">(</span>X_train<span class=\"token\" style=\"color:#393A34\">,</span> Y_train<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[ ]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># get preds</span>\nxgb_preds <span class=\"token\" style=\"color:#393A34\">=</span> xgb_clf<span class=\"token\" style=\"color:#393A34\">.</span>predict<span class=\"token\" style=\"color:#393A34\">(</span>scaler<span class=\"token\" style=\"color:#393A34\">.</span>transform<span class=\"token\" style=\"color:#393A34\">(</span>X_test<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\nxgb_confmat <span class=\"token\" style=\"color:#393A34\">=</span> confusion_matrix<span class=\"token\" style=\"color:#393A34\">(</span>Y_test<span class=\"token\" style=\"color:#393A34\">,</span> xgb_preds<span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>np<span class=\"token\" style=\"color:#393A34\">.</span>around<span class=\"token\" style=\"color:#393A34\">(</span>xgb_confmat <span class=\"token\" style=\"color:#393A34\">/</span> xgb_confmat<span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">sum</span><span class=\"token\" style=\"color:#393A34\">(</span>axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">,</span> keepdims<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> decimals<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">2</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>classification_report<span class=\"token\" style=\"color:#393A34\">(</span>Y_test<span class=\"token\" style=\"color:#393A34\">,</span> xgb_preds<span class=\"token\" style=\"color:#393A34\">,</span> target_names<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;good&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;warning&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;bad&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[ ]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"></code></pre></div></div></div></div>","fields":{"srcLink":"https://github.com/aicoe-aiops/ceph_drive_failure/blob/master/notebooks/step3b_ternary_clf.ipynb"}}},"pageContext":{"id":"70c576d9-0c33-5452-b94d-2381c6774f9e >>> JupyterNotebook"}},"staticQueryHashes":["117426894","3000541721"]}