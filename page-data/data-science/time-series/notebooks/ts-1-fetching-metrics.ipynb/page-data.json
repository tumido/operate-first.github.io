{"componentChunkName":"component---src-templates-jupyter-notebook-js","path":"/data-science/time-series/notebooks/ts-1-fetching-metrics.ipynb","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"jupyterNotebook":{"id":"21be9f0e-a0be-5a43-aa5f-0c165eb918c3 >>> JupyterNotebook","html":"<div class=\"notebook-render\"><div class=\"sc-ifAKCX zMCZx\"><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h1>Fetching metrics</h1>\n<p>In this notebook, we will learn how to use the Prometheus API client for fetching and formatting the raw metrics obtained from a <a href=\"https://prometheus.io/\">Prometheus</a> host to drive better data science analysis on these metrics. </p>\n<p>You can find more information about the functions of the <a href=\"https://prometheus-api-client-python.readthedocs.io/source/prometheus_api_client.html\">API client here</a>.</p>\n<h2>Installing the library:</h2>\n<p>To begin any exploratory analysis, we need to first install all the required packages. </p>\n<p>For this notebook in particular, the <a href=\"https://pypi.org/project/prometheus-api-client/\">prometheus api client library</a> needs to be installed.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[1]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># !pip3 install prometheus-api-client</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># !pip3 install matplotlib pandas</span>\n\n<span class=\"token\" style=\"color:#0000ff\">from</span> prometheus_api_client <span class=\"token\" style=\"color:#0000ff\">import</span> PrometheusConnect\n<span class=\"token\" style=\"color:#0000ff\">from</span> prometheus_api_client<span class=\"token\" style=\"color:#393A34\">.</span>metric_range_df <span class=\"token\" style=\"color:#0000ff\">import</span> MetricRangeDataFrame\n<span class=\"token\" style=\"color:#0000ff\">from</span> prometheus_api_client<span class=\"token\" style=\"color:#393A34\">.</span>utils <span class=\"token\" style=\"color:#0000ff\">import</span> parse_datetime\n<span class=\"token\" style=\"color:#0000ff\">from</span> datetime <span class=\"token\" style=\"color:#0000ff\">import</span> timedelta\n<span class=\"token\" style=\"color:#0000ff\">import</span> pandas <span class=\"token\" style=\"color:#0000ff\">as</span> pd</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Connecting to Prometheus</h2>\n<p>The <code>PrometheusConnect</code> module of the library can be used to connect to a Prometheus host.</p>\n<p>To know more about this module, you can refer to the <a href=\"https://prometheus-api-client-python.readthedocs.io/en/master/source/prometheus_api_client.html#module-prometheus_api_client.prometheus_connect\">documentation</a></p>\n<p>We will connect to a public prometheus instance: <a href=\"http://demo.robustperception.io:9090\">http://demo.robustperception.io:9090</a></p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[2]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">prom_url <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;http://demo.robustperception.io:9090&quot;</span>\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;Prometheus uri: &quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> prom_url<span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Creating the prometheus connect object with the required parameters</span>\npc <span class=\"token\" style=\"color:#393A34\">=</span> PrometheusConnect<span class=\"token\" style=\"color:#393A34\">(</span>url<span class=\"token\" style=\"color:#393A34\">=</span>prom_url<span class=\"token\" style=\"color:#393A34\">,</span> disable_ssl<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Fetching a list of all metrics scraped by the Prometheus host.</span>\npd<span class=\"token\" style=\"color:#393A34\">.</span>DataFrame<span class=\"token\" style=\"color:#393A34\">(</span>pc<span class=\"token\" style=\"color:#393A34\">.</span>all_metrics<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> columns<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#A31515\">&quot;metrics&quot;</span><span class=\"token\" style=\"color:#393A34\">}</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>Prometheus uri:  http://demo.robustperception.io:9090\n</span></code><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>metrics</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>ALERTS</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>ALERTS_FOR_STATE</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>alertmanager_alerts</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>alertmanager_alerts_invalid_total</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>alertmanager_alerts_received_total</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>501</th>\n      <td>scrape_duration_seconds</td>\n    </tr>\n    <tr>\n      <th>502</th>\n      <td>scrape_samples_post_metric_relabeling</td>\n    </tr>\n    <tr>\n      <th>503</th>\n      <td>scrape_samples_scraped</td>\n    </tr>\n    <tr>\n      <th>504</th>\n      <td>scrape_series_added</td>\n    </tr>\n    <tr>\n      <th>505</th>\n      <td>up</td>\n    </tr>\n  </tbody>\n</table>\n<p>506 rows × 1 columns</p>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Fetching Metrics from Prometheus</h2>\n<p>Every metric in Prometheus is stored as <strong>time series</strong> data: streams of timestamped values belonging to the same metric and the same set of labeled dimensions. Each of these time series is uniquely identified by:</p>\n<ul>\n<li><strong>metric name</strong> - Specifies the general feature of a system that is measured.\nE.g. <code>http_requests_total</code> - the total number of HTTP requests received.</li>\n<li><strong>labels</strong> - Provides more details to identify a particular dimensional instantiation of the metric. E.g. <code>http_requests_total{method=&quot;POST&quot;, handler=&quot;/api/tracks&quot;}</code>: all HTTP requests that used the method POST to the /api/tracks handler</li>\n</ul>\n<p>Prometheus provides a functional query language called <strong>PromQL (Prometheus Query Language)</strong> that lets the user select and aggregate time series data in real time. </p>\n<p>The <code>get_current_metric_value()</code> method in the library can be used to fetch metrics according to this PromQL format.</p>\n<p>Parameters:\t</p>\n<ul>\n<li><strong>metric_name</strong> – (str) This is a PromQL query, a few examples can be found at <a href=\"https://prometheus.io/docs/prometheus/latest/querying/examples/\">https://prometheus.io/docs/prometheus/latest/querying/examples/</a></li>\n<li><strong>params</strong> – (dict) Optional dictionary containing GET parameters to be sent along with the API request, such as “time”</li>\n</ul>\n<h3>Examples of fetching metrics using different queries</h3></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[3]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Here, we are fetching the current values of a particular metric name</span>\npc<span class=\"token\" style=\"color:#393A34\">.</span>get_current_metric_value<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;alertmanager_alerts&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>[{&#x27;metric&#x27;: {&#x27;__name__&#x27;: &#x27;alertmanager_alerts&#x27;,\n   &#x27;instance&#x27;: &#x27;demo.robustperception.io:9093&#x27;,\n   &#x27;job&#x27;: &#x27;alertmanager&#x27;,\n   &#x27;state&#x27;: &#x27;active&#x27;},\n  &#x27;value&#x27;: [1606158844.546, &#x27;4&#x27;]},\n {&#x27;metric&#x27;: {&#x27;__name__&#x27;: &#x27;alertmanager_alerts&#x27;,\n   &#x27;instance&#x27;: &#x27;demo.robustperception.io:9093&#x27;,\n   &#x27;job&#x27;: &#x27;alertmanager&#x27;,\n   &#x27;state&#x27;: &#x27;suppressed&#x27;},\n  &#x27;value&#x27;: [1606158844.546, &#x27;0&#x27;]}]</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[4]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Now, let&#x27;s see if we can fetch a particular label configuration of this metric</span>\npc<span class=\"token\" style=\"color:#393A34\">.</span>get_current_metric_value<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;alertmanager_alerts{state=&#x27;active&#x27;}&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>[{&#x27;metric&#x27;: {&#x27;__name__&#x27;: &#x27;alertmanager_alerts&#x27;,\n   &#x27;instance&#x27;: &#x27;demo.robustperception.io:9093&#x27;,\n   &#x27;job&#x27;: &#x27;alertmanager&#x27;,\n   &#x27;state&#x27;: &#x27;active&#x27;},\n  &#x27;value&#x27;: [1606158848.546, &#x27;4&#x27;]}]</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[5]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Sum of all the values of a metric</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># You can also try methods such as rate, and count</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># More functions here: https://prometheus.io/docs/prometheus/latest/querying/examples/</span>\npc<span class=\"token\" style=\"color:#393A34\">.</span>get_current_metric_value<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;sum(scrape_duration_seconds)&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>[{&#x27;metric&#x27;: {}, &#x27;value&#x27;: [1606158849.597, &#x27;0.042080264&#x27;]}]</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h3>Collecting Historical Data</h3>\n<p>Suppose we want to fetch historical data instead of just the current value, say the past few days of data, we can do so by using the <code>get_metric_range_data()</code> method. This method will fetch the data for the specifed metric label configuration within the time range specified.\nAlong with specifying the start_time and end_time for the metric data collection, we need to specify the chunk size or the amount of data requested in one go. A large chunk size can result in non responsive code if the data is huge. If the end goal is to create a data frame, the chunk size will not affect the final frame size. Therefore it is a good practice to make sure the chunk size is balanced, i.e, not too high or not too low.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[6]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">metric_data <span class=\"token\" style=\"color:#393A34\">=</span> pc<span class=\"token\" style=\"color:#393A34\">.</span>get_metric_range_data<span class=\"token\" style=\"color:#393A34\">(</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;alertmanager_alerts{job=&#x27;alertmanager&#x27;}&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>  <span class=\"token\" style=\"color:#008000;font-style:italic\"># metric name and label config</span>\n    start_time<span class=\"token\" style=\"color:#393A34\">=</span>parse_datetime<span class=\"token\" style=\"color:#393A34\">(</span>\n        <span class=\"token\" style=\"color:#A31515\">&quot;2d&quot;</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span>  <span class=\"token\" style=\"color:#008000;font-style:italic\"># datetime object for metric range start time</span>\n    end_time<span class=\"token\" style=\"color:#393A34\">=</span>parse_datetime<span class=\"token\" style=\"color:#393A34\">(</span>\n        <span class=\"token\" style=\"color:#A31515\">&quot;now&quot;</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span>  <span class=\"token\" style=\"color:#008000;font-style:italic\"># datetime object for metric range end time</span>\n    chunk_size<span class=\"token\" style=\"color:#393A34\">=</span>timedelta<span class=\"token\" style=\"color:#393A34\">(</span>\n        hours<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">12</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span>  <span class=\"token\" style=\"color:#008000;font-style:italic\"># timedelta object for duration of metric data downloaded in one request</span>\n<span class=\"token\" style=\"color:#393A34\">)</span>\nmetric_data<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;metric&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>{&#x27;__name__&#x27;: &#x27;alertmanager_alerts&#x27;,\n &#x27;instance&#x27;: &#x27;demo.robustperception.io:9093&#x27;,\n &#x27;job&#x27;: &#x27;alertmanager&#x27;,\n &#x27;state&#x27;: &#x27;active&#x27;}</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h3>Creating pandas Data Frame</h3>\n<p>We can easily create a pandas data frame from the json response using the <code>MetricRangeDataFrame</code> class.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[7]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">metric_df <span class=\"token\" style=\"color:#393A34\">=</span> MetricRangeDataFrame<span class=\"token\" style=\"color:#393A34\">(</span>metric_data<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[8]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">metric_df</code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>__name__</th>\n      <th>instance</th>\n      <th>job</th>\n      <th>state</th>\n      <th>value</th>\n    </tr>\n    <tr>\n      <th>timestamp</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1.605986e+09</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>active</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>1.605986e+09</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>active</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>1.605986e+09</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>active</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>1.605986e+09</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>active</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>1.605986e+09</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>active</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>1.606159e+09</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>suppressed</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>1.606159e+09</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>suppressed</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>1.606159e+09</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>suppressed</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>1.606159e+09</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>suppressed</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>1.606159e+09</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>suppressed</td>\n      <td>0</td>\n    </tr>\n  </tbody>\n</table>\n<p>34558 rows × 5 columns</p>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h4>Converting utc timestamp to python datetime object</h4></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[9]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">metric_df<span class=\"token\" style=\"color:#393A34\">.</span>index <span class=\"token\" style=\"color:#393A34\">=</span> pd<span class=\"token\" style=\"color:#393A34\">.</span>to_datetime<span class=\"token\" style=\"color:#393A34\">(</span>metric_df<span class=\"token\" style=\"color:#393A34\">.</span>index<span class=\"token\" style=\"color:#393A34\">,</span> unit<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;s&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> utc<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[10]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">metric_df</code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>__name__</th>\n      <th>instance</th>\n      <th>job</th>\n      <th>state</th>\n      <th>value</th>\n    </tr>\n    <tr>\n      <th>timestamp</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>2020-11-21 19:14:16.102999926+00:00</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>active</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>2020-11-21 19:14:26.095999956+00:00</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>active</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>2020-11-21 19:14:36.095999956+00:00</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>active</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>2020-11-21 19:14:46.098000050+00:00</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>active</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>2020-11-21 19:14:56.105000019+00:00</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>active</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>2020-11-23 19:13:26.095999956+00:00</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>suppressed</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>2020-11-23 19:13:36.105000019+00:00</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>suppressed</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>2020-11-23 19:13:46.114000082+00:00</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>suppressed</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>2020-11-23 19:13:56.096999884+00:00</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>suppressed</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>2020-11-23 19:14:06.095999956+00:00</th>\n      <td>alertmanager_alerts</td>\n      <td>demo.robustperception.io:9093</td>\n      <td>alertmanager</td>\n      <td>suppressed</td>\n      <td>0</td>\n    </tr>\n  </tbody>\n</table>\n<p>34558 rows × 5 columns</p>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h1>Conclusion</h1>\n<p>Great! In this notebook we saw how to use prometheus api client to create a pandas time series dataframe that can be used for analysis. In the next post, we will learn how to manipulate and visualize this dataframe.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[ ]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"></code></pre></div></div></div></div>","fields":{"srcLink":"https://github.com/aicoe-aiops/time-series/blob/master/notebooks/ts-1-fetching-metrics.ipynb"}}},"pageContext":{"id":"21be9f0e-a0be-5a43-aa5f-0c165eb918c3 >>> JupyterNotebook"}},"staticQueryHashes":["117426894","3000541721"]}