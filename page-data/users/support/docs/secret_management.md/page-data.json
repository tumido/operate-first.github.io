{"componentChunkName":"component---src-templates-markdown-js","path":"/users/support/docs/secret_management.md","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"markdownRemark":{"id":"c5dc22db-0518-5f57-92c0-a824c66e8a53","html":"<h1 id=\"secret-management-for-applications\" style=\"position:relative;\"><a href=\"#secret-management-for-applications\" aria-label=\"secret management for applications permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Secret management for applications</h1>\n<p>This onboarding guide will help you set up your application’s secrets in a way that will make them consumable by our ArgoCD deployments, while not compromising the resource confidentiality.</p>\n<h2 id=\"prerequisites\" style=\"position:relative;\"><a href=\"#prerequisites\" aria-label=\"prerequisites permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prerequisites</h2>\n<ol class=\"pf-c-list\">\n<li>Please install GPG and <a href=\"https://github.com/mozilla/sops\">SOPS</a></li>\n<li>Have ready your own/team-owned secret GPG key that you want to access the encrypted data with</li>\n</ol>\n<h2 id=\"obtain-operatefirst-gpg-public-key\" style=\"position:relative;\"><a href=\"#obtain-operatefirst-gpg-public-key\" aria-label=\"obtain operatefirst gpg public key permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Obtain OperateFirst GPG public key</h2>\n<p>Please fetch <a href=\"http://keys.gnupg.net/pks/lookup?op=vindex&#x26;fingerprint=on&#x26;search=0x4DC4116D360E3276\"><code class=\"language-text\">0508677DD04952D06A943D5B4DC4116D360E3276</code> GPG key</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">gpg --keyserver keys.gnupg.net --recv 0508677DD04952D06A943D5B4DC4116D360E3276</code></pre></div>\n<h2 id=\"create-sops-file\" style=\"position:relative;\"><a href=\"#create-sops-file\" aria-label=\"create sops file permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create sops file</h2>\n<p>Please create a <code class=\"language-text\">.sops.yaml</code> file within your application manifests repository with the following content:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">creation_rules</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">encrypted_regex</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"^(data|stringData)$\"</span>\n    <span class=\"token key atrule\">pgp</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"0508677DD04952D06A943D5B4DC4116D360E3276, YOUR_TEAM_GPG_KEY_FIGERPRINT\"</span></code></pre></div>\n<p>This creation rule specifies:</p>\n<ul class=\"pf-c-list\">\n<li><code class=\"language-text\">encrypted_regex</code> instructs SOPS to (by default) encrypt only the <code class=\"language-text\">data</code> or <code class=\"language-text\">stringData</code> properties of resources</li>\n<li><code class=\"language-text\">pgp</code> specifies which GPG keys to be used for the encryption. Multiple key fingerprints can be specified here separated by a comma. Each of the private GPG key holders to fingerprints specified in this list will be able to decrypt and reencrypt the resource.</li>\n</ul>\n<p>For more details on the SOPS configuration, please consult the SOPS documentation](<a href=\"https://github.com/mozilla/sops\">https://github.com/mozilla/sops</a>).</p>\n<h2 id=\"encrypting-a-resource\" style=\"position:relative;\"><a href=\"#encrypting-a-resource\" aria-label=\"encrypting a resource permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Encrypting a resource</h2>\n<p>To encrypt a resource, run the <code class=\"language-text\">sops --encrypt/-e</code> command:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">sops -e path/to/resource.yaml &gt; path/to/resource.enc.yaml</code></pre></div>\n<p>Please make sure the encrypted resource includes the <code class=\"language-text\">0508677DD04952D06A943D5B4DC4116D360E3276</code> GPG key, otherwise our ArgoCD won’t be able to decrypt and apply the resource.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">grep &quot;fp: &quot; path/to/resource.enc.yaml\n        fp: 0508677DD04952D06A943D5B4DC4116D360E3276\n        fp: YOUR_TEAM_GPG_KEY_FIGERPRINT</code></pre></div>\n<h2 id=\"updating-a-resource\" style=\"position:relative;\"><a href=\"#updating-a-resource\" aria-label=\"updating a resource permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Updating a resource</h2>\n<p>If you hold one of the GPG keys needed for the decryption, SOPS CLI allows you to also update the resource. Be advised: You need to have public keys to all the used GPG keys in your keyring otherwise the encryption after your changes won’t be successful. Running the following command, SOPS decrypts the resource and opens it in your default editor. The resource will be reencrypted when the file is save and editor closed:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">sops path/to/resource.enc.yaml</code></pre></div>\n<h2 id=\"enabling-argocd-for-decryption\" style=\"position:relative;\"><a href=\"#enabling-argocd-for-decryption\" aria-label=\"enabling argocd for decryption permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Enabling ArgoCD for decryption</h2>\n<p>Based on the toolkit you use to structure your manifests with, please follow these guides:</p>\n<ol class=\"pf-c-list\">\n<li>For Kustomize manifests, please use <code class=\"language-text\">ksops</code>. Please follow <a href=\"https://github.com/viaduct-ai/kustomize-sops\">the upstream documentation for ksops</a>.</li>\n<li>For Helm manifests, please use <code class=\"language-text\">helm-secrets</code>. Please follow <a href=\"https://github.com/jkroepke/helm-secrets\">the upstream documentation for helm-secrets</a>.</li>\n</ol>","fields":{"srcLink":"https://github.com/operate-first/support/blob/master/docs/secret_management.md"},"frontmatter":{"title":"","description":null}}},"pageContext":{"id":"c5dc22db-0518-5f57-92c0-a824c66e8a53"}},"staticQueryHashes":["117426894","3000541721"]}