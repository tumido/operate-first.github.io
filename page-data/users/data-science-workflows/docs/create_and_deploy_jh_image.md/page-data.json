{"componentChunkName":"component---src-templates-markdown-js","path":"/users/data-science-workflows/docs/create_and_deploy_jh_image.md","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"markdownRemark":{"id":"3d40f6a8-292f-5266-a114-bc14e273b0a6","html":"<h1 id=\"how-to-create-a-jupyterhub-image-and-deploy-it-on-odh\" style=\"position:relative;\"><a href=\"#how-to-create-a-jupyterhub-image-and-deploy-it-on-odh\" aria-label=\"how to create a jupyterhub image and deploy it on odh permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to create a Jupyterhub image and deploy it on ODH</h1>\n<p>This howto is about getting your repository built into an image and having that image made available in (your) Jupyterhub instance.</p>\n<p>We are going to deal with 2 issues:</p>\n<ol class=\"pf-c-list\">\n<li>Build an image and add to a public image repository.</li>\n<li>Add your image to an ODH instance (that has a Jupyterhub in it).</li>\n</ol>\n<p>If you don’t have an ODH instance that you would like to work with, you can create one using these guides:</p>\n<p><a href=\"https://github.com/operate-first/continuous-deployment/tree/master/docs\">https://github.com/operate-first/continuous-deployment/tree/master/docs</a></p>\n<h2 id=\"build-an-image\" style=\"position:relative;\"><a href=\"#build-an-image\" aria-label=\"build an image permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Build an image</h2>\n<p>If your image is not yet built, you can use <a href=\"https://thoth-station.ninja/\">Thoth</a> to do it for you using a config file in your repo.</p>\n<p>Here’s an example that goes together with the above example of an ImageStream:</p>\n<p><a href=\"https://github.com/aicoe-aiops/categorical-encoding/blob/master/.aicoe-ci.yaml\">https://github.com/aicoe-aiops/categorical-encoding/blob/master/.aicoe-ci.yaml</a></p>\n<p>I am going to compile this into a guide and would be grateful for your testing of the process or improvement suggestions.</p>\n<p>Information on enabling Thoth on your repo is here: <a href=\"https://github.com/AICoE/aicoe-ci#setting-aicoe-ci-on-github-organizationrepository\">https://github.com/AICoE/aicoe-ci#setting-aicoe-ci-on-github-organizationrepository</a></p>\n<p>For 3rd party projects outside of the AICoE, one should change the value of <code class=\"language-text\">registry-org</code> (quay.io org) to his own value.</p>\n<h3 id=\"steps-to-have-your-notebook-repo-build-into-an-image-by-thoth\" style=\"position:relative;\"><a href=\"#steps-to-have-your-notebook-repo-build-into-an-image-by-thoth\" aria-label=\"steps to have your notebook repo build into an image by thoth permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Steps to have your notebook repo build into an image by Thoth</h3>\n<h3 id=\"enable-the-ci-integration\" style=\"position:relative;\"><a href=\"#enable-the-ci-integration\" aria-label=\"enable the ci integration permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Enable the CI integration</h3>\n<p>To get image built by Thoth (in Tekton?) (not sure what is the right formulation here) and uploaded to quay.io (image registry) one needs to add the “aicoe-ci” app to the project:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/10362bbf2384a424764e557def3ac094/1790f/ci-integration.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB8klEQVQoz31Sa2/TMBTN70DQlTYwdTy0rmjjIb6gfWHQTaRaCaNSUQUS/5WPfAexV5PmHWzHThybE3caMMqOEvtavufec25i9QePN7d27j3ob9zf7Ni9jr3evdPrrm+0bttrbbvV7t5a69y42W617e0nz/vPng4ebd/tPdwa7Oy+2LVmnz4fupPR+Oj1wWhv39l3xu7kw3jkjt++P5rO3MnUOXz36mC0vN0bOi+Hb4aOi/zp7KNVlhXJ0rOTH3PPZ0UhiiL9/s0/PSX+QjDGhRBlZR65DIDSgFJqaa2biBBtUNdSEMKShOV5wTmljPIyZyIlgpZKKn0JsBpyJWWSpDg0cVURxihjBYcI0Dk3Cy+Kuq71H4AmQ65kGIaEUsRc8CAM0zStZa2UAgGbXoULMoxkeY6eyJa1RJz/JHixZwYQJaVEAlZl8Fs2tkUQsIKhDcjQTAg1ShswuIB1s+J4lYyScRwvZUNMkiSmc37F5GrZoiw9z0dhpRuTaAImOksD9Tf+GZiUcZLAudbNNTQHZn6iQfm/zqh74fl87gnzqTDbjPLz+fzs+IRzcY1stLHMj1GTy2FoJbI0XwQszXiW1Y0XrUzqanLZePaiOK4a5VoxzqOYRFHu+8pMcdlgNRme0yzDhBAvWPQl+MoIk6bQNUC5XyfvFodEMfoxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Setting up CI integration with Thoth\"\n        title=\"Setting up CI integration with Thoth\"\n        src=\"/static/10362bbf2384a424764e557def3ac094/fcda8/ci-integration.png\"\n        srcset=\"/static/10362bbf2384a424764e557def3ac094/12f09/ci-integration.png 148w,\n/static/10362bbf2384a424764e557def3ac094/e4a3f/ci-integration.png 295w,\n/static/10362bbf2384a424764e557def3ac094/fcda8/ci-integration.png 590w,\n/static/10362bbf2384a424764e557def3ac094/efc66/ci-integration.png 885w,\n/static/10362bbf2384a424764e557def3ac094/c83ae/ci-integration.png 1180w,\n/static/10362bbf2384a424764e557def3ac094/1790f/ci-integration.png 1189w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>If your project is under the <code class=\"language-text\">aicoe-aiops</code> (and some other) GH orgs then this is already done on the org level and you don’t need to do this step.</p>\n<h3 id=\"setting-up-the-image-repository\" style=\"position:relative;\"><a href=\"#setting-up-the-image-repository\" aria-label=\"setting up the image repository permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setting up the image repository</h3>\n<p>Next you need to have a place to upload the built images. For that you need an account and a project on quay.io.</p>\n<p>Again there already exists an ‘AICoE’ organization in Quay: <a href=\"https://quay.io/organization/aicoe\">https://quay.io/organization/aicoe</a> so if your project is part of AICoE you can use that.</p>\n<p>Thoth needs to be able to access your project — push images into it. That can be accomplished by creating a robot account with a push (pull) secret.</p>\n<p>There are pre-configured push secrets for various projects already present in Thoth. See the bottom of this page: <a href=\"https://github.com/AICoE/aicoe-ci#services-and-features\">https://github.com/AICoE/aicoe-ci#services-and-features</a>.</p>\n<p>If your project is in one of these, you can skip this step.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/24e4ecd5fa7e9b0b26d1560a9c068cdb/48ca3/quay-robot.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABw0lEQVQoz3WRS2vbUBCF9StbW/IrsSVHCummFGqbkATyH1JqSDeKwA+wszeFbrpIjSxvmgYnGDsLPTCNLelaunq5R3LpItCPy2EY3Zl7ZsTUjyTp+N1hlT84rBWL5VLpoFiqIMjluTdv8zh5tlCtCa3Tc/HD+2bjY41HwcnlxQUKmceHX8vnZ8uyPM9zXXevm82GEAJ1HAcZ27ajKAoo1Q1zMZ8//Lzfen4cx0w+I5fLQTmWRcBx3IkkSpIkCIIoilCWZfGpUCiKdaHOV4/4Wl3gK5UK0263ZVm+yVAUpdPpdLvd2+FgMBjeDlMQIdPr9fr9/rXcufqiXF0rcndQLpcZmAmCIMyAt91/SJIEOrr//fnb8tPX+fclPT87ZZzFwnMcw7JWq5VpWbqum8AwdMOAAjsDi7AxPyEece31Cxq1Wi1mY5pRECRp65Q4ec3+Zfii8BiGyMAiMs1mk3l8evJ9SjzqEm+79eMwjKMINzACbkOxVUp9gHpsHgHGRHGj0WDg0SckeVnvHDe03WDtJi55NTCNd1HmIGtE96tJi0ej0Xg8nqrq9O5OS88PbaJN/6FNNQ0J8DcxmUxUVZ3NZviLfwAPq9YZeAdTSAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Quay pull secret setup\"\n        title=\"Quay pull secret setup\"\n        src=\"/static/24e4ecd5fa7e9b0b26d1560a9c068cdb/fcda8/quay-robot.png\"\n        srcset=\"/static/24e4ecd5fa7e9b0b26d1560a9c068cdb/12f09/quay-robot.png 148w,\n/static/24e4ecd5fa7e9b0b26d1560a9c068cdb/e4a3f/quay-robot.png 295w,\n/static/24e4ecd5fa7e9b0b26d1560a9c068cdb/fcda8/quay-robot.png 590w,\n/static/24e4ecd5fa7e9b0b26d1560a9c068cdb/efc66/quay-robot.png 885w,\n/static/24e4ecd5fa7e9b0b26d1560a9c068cdb/48ca3/quay-robot.png 1084w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>After creating the robot you need to set the permissions it will possess.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3a6e2c9ee1a48338dbf0e809b91590f5/e3829/quay-secret.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84.45945945945947%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACdUlEQVQ4y4VTbU/aUBTuP1wWp0yFQakowlzi/ocLCHwRY1xSFMzqln3YdxMTN8ZLtgTfFpeF8ZIV+sptS+9tLzttVXSJ7slJ7r1pn3Oe85x7mXAkxi2txNilyIvY/ELk2WzIi7nns6H5IGZmQ0+ezrDxxHJqjUsnkyurc6GFZDK1ln7JdC8vLs/P2+22KIqmaaqahhDSFUWT5bGq2UMJq9pIUUa6ThxHkqR+v39xeqrIMiaEYWOxxJKHBcDiYpxlX3Hc62RyNR5PcdxKNJrmuPVUaj2RWI5Gw5FIeNFDJBxmWZZJpdM7Ozs8z+/u7r71Iezvf6hUhFJJ4Pl3PH9YKh3u7X08OBDK5XLFA6yCILzZ2GC2t7dBp+u61MPEcWDrTh5F8EOr1WKy2Wyn07EsyzRMzYOqKgqEcwdePlgICY4YYyDX63Umn8+DVfBdkqWRaVk2oZMJvV/KtAnYQyc0iKBys9lkCoXCcDiErFKvj1Td0hAxLernvgalSNMwQpObdqbkTCbb7fWc8djodm1ZwiOERInIis+ingqMUb+DRXGMVIQN27Gn5M3NTZAN3YCwMTJcy6KEuH76ANCkZo4wJmfS2dHvoyv1KqjfaDSgcuaPKGLbBuXguHNtO/2v2x65WCxCbtu2VVXVdR18JoT88ze9jyl5a6sI1UCzLMuDwaDX68HYYXIPTRvIMLvpqAzDCEan+RcbKsPxEeVBXo+cy+UMhED23SvxEM1x6bdfcvXH4Kxvfq5+Bbdz8JiguAJPZwSPR4f6t7nIza2CDTRrO+77anv/+Oen7+LxyRdvVLeyg5aI3z/MT7oDsAMc9VNcG1ar1f4C+lZqZlYCcAQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Quay: setup permissions\"\n        title=\"Quay: setup permissions\"\n        src=\"/static/3a6e2c9ee1a48338dbf0e809b91590f5/fcda8/quay-secret.png\"\n        srcset=\"/static/3a6e2c9ee1a48338dbf0e809b91590f5/12f09/quay-secret.png 148w,\n/static/3a6e2c9ee1a48338dbf0e809b91590f5/e4a3f/quay-secret.png 295w,\n/static/3a6e2c9ee1a48338dbf0e809b91590f5/fcda8/quay-secret.png 590w,\n/static/3a6e2c9ee1a48338dbf0e809b91590f5/efc66/quay-secret.png 885w,\n/static/3a6e2c9ee1a48338dbf0e809b91590f5/e3829/quay-secret.png 1077w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>And finally, you need to copy the secret and give it to Thoth. Copy the secret here:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b61e36b371b1c716b08b8897997001a3/18539/quay-secret-cred.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.37837837837837%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAC7UlEQVQoz02SS0tbQRTH7xdQcaPiE9pPkKrUR6pUpTZpS6lNhAqxFF0Jje1C6iJu2kKWBemmICjRnbjSmLow4GNjH3s1GG+Se2cyuTf3PffGvG5PEov5cxhmhvnN/5wzw0w+db94+erJpHt0dGxo+NHgkBMCJgODww96+yH6+h729Q88cz+fmn7j9kx5X3tGRsY8nul3vlnm08cPCwsLwWAwEomE98J7oHD44OBgH9aRn5XJfgQCtmG9t7t7eBjdCoX87/2BlRXG4XDcu3d/cXFRkSXE86KQkWXZoFSFdVbUdb2Qz5fLpZoKxaJt27/OznodDkiJcTqdE+PjX74GSQLxlxcodqUhJIlSCgtJRHgeE0EmoiLLqmmahUIB4N9//o48nph0uZnZ2beBQCAU2uLZFHt+zp5fZBGmkiInkcwRPSNpWFS5dF7VASuWSjBexpP+z9+//QgxPp9veXl5bW2NTbCXsdhVPI4w1gxD5HlLFGyT2tSAKFlmkVI7l7PLZfu/buH19fVkMhmPx2OxWCKRoKYpcZzK8xrGOTFriWKuGiVZtqtll6tivF6v3+/f2NjgeZ5l2evra4QQ9ClNCM9xiOMEQkRCYCQYZzIZAkFIOp2GY8zMzMzS0tLm5qYgCBhj2AVM08AS8wilUinYz0qSoqrwBNAzwzBykHwtbZfLBfzq6qooinAZrsq0rHw+X+ttvcrVgsF5e3t7Z2eH6e7ubm5unp+fh+eFzGvmggj94uEQpRSsoArIBXzhRoCPjo4AaWlpYbq6upqamgBWFKUGg4ChZgVTVbXCVUfTpHAJwMfHxx0dHT09PXdwvbMoCARnEERagF+CiKAa1k3Rplal2tPT07a2NgAZuKOxsbEeBlpXFF2QdFlTNV1WNWrd5PIF66ZgUBPgk5OT1tbWO3hubu42bYTAOZvNpjhOVmSrKkjYrLQa0q78s2g0Cs6dnZ1Me3t7Q0PDHVxNW5EVeHOYQ9m0TlB+DYZuges/9krMoaMcm4MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"quay-robot-2\"\n        title=\"quay-robot-2\"\n        src=\"/static/b61e36b371b1c716b08b8897997001a3/fcda8/quay-secret-cred.png\"\n        srcset=\"/static/b61e36b371b1c716b08b8897997001a3/12f09/quay-secret-cred.png 148w,\n/static/b61e36b371b1c716b08b8897997001a3/e4a3f/quay-secret-cred.png 295w,\n/static/b61e36b371b1c716b08b8897997001a3/fcda8/quay-secret-cred.png 590w,\n/static/b61e36b371b1c716b08b8897997001a3/efc66/quay-secret-cred.png 885w,\n/static/b61e36b371b1c716b08b8897997001a3/18539/quay-secret-cred.png 1074w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>This is currently a manual process so just, please, send the secret (the whole yaml) to @harshad16 to have it added.</p>\n<p>Remember, this is only if you actually need new push secret. That is if Thoth does not have it already preconfigured.</p>\n<h3 id=\"adding-configuration-file-to-your-repo\" style=\"position:relative;\"><a href=\"#adding-configuration-file-to-your-repo\" aria-label=\"adding configuration file to your repo permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Adding configuration file to your repo</h3>\n<p>Next we need to finish configuration of the source repo. This is done by adding a config file named <code class=\"language-text\">.aicoe-ci.yaml</code>.</p>\n<p>Here’s an example of a working minimal config: <a href=\"https://github.com/aicoe-aiops/project-template/blob/master/.aicoe-ci.yaml\">https://github.com/aicoe-aiops/project-template/blob/master/.aicoe-ci.yaml</a></p>\n<p>Uncomment the <code class=\"language-text\">build</code> section to enable Thoth build.</p>\n<p>The builder can do a number of things. To have the S2I correctly build these 2 lines are essential:</p>\n<p>The important parts for building the image using S2I into a format expected by JH is:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  build-source-script: &quot;image:///opt/app-root/builder&quot;\n  base-image: quay.io/thoth-station/s2i-custom-notebook:latest</code></pre></div>\n<p>Modify the lines in the <code class=\"language-text\">build</code> section:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  registry-org: aicoe\n  registry-project: my_project\n  registry-secret: aicoe-pusher-secret</code></pre></div>\n<p>to match the project and robot’s push secret you have setup in Quay.</p>\n<h3 id=\"triggering-the-build\" style=\"position:relative;\"><a href=\"#triggering-the-build\" aria-label=\"triggering the build permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Triggering the build</h3>\n<p>Once you have this in your repo. You can trigger the build by doing a release. This is something that will be done for you automatically if you are using the whole Thoth toolset. But for minimal working setup, you can create a release manually.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ea86315a74ee37b4084253357c84c241/84bf8/gh-tag.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.62162162162163%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACKklEQVQoz11S204UQRSc3/DBRFzYZQOIEEn0F30EAruAwiJK/AA/wA/wQRMTIy/EgOzszPS9p+8z1rBKwMpJ55xOn66q051tvHi5ufVqeWW9P1zrLS0/6Q16g5X+8NnC4rDXX0G+sDR89PgpksHaRn91fTBcWxyurz7f2tzcyvbGR+Pj852DyfZ48nrnze74ZPLu/dmHj5Ozc6yI07Pzw7cTHNveG+2Pj3b3D0aHJ6PD4+OT04wLqXyrfKNDQ21bhxZITZOabm3af2jaJrbY8CHeVh2yYpZrTmspjOCGM0mItVbX2hgjlZJSaaVLRr5Nf1wUl5yj1jGlEKN1LqsqIpThhInrqbjJHeG3nF0YH7kySrsbVp1+//T56ouSqq5r3I41hJDls/I6J5e/y5zqQliiQylspTw3CUGUr6TrdqjTJoFWCAlO6IKFrCIEritCGedaa6U0UhTO+RjTPEKIlPPa2Dnz3RwySmltDGOcUBzg1johJabovO8Gc4uUklI1dqSS02rmov/bTDpmWRQlzBNCIQwqyopA210zyBkXsOpia0PzgBkG0C+EgGwcQD9mink092CM9SHgdkpZ271gFxlKuJ3m+awourfBw5QVdMyZ7wAjcFe7VEmvXXzADM9cCOfcnBlCvIe+/5klo4KUjbfJ1k3wXTOopZQxRkjtPFOGP4Ap3ZcNZtyr81/5z6/86sLll0nRrhk8lLG5EmhD7u5Naw6ta/fQCPAHmS/i1HPzqdsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Trigger a build in GH\"\n        title=\"Trigger a build in GH\"\n        src=\"/static/ea86315a74ee37b4084253357c84c241/fcda8/gh-tag.png\"\n        srcset=\"/static/ea86315a74ee37b4084253357c84c241/12f09/gh-tag.png 148w,\n/static/ea86315a74ee37b4084253357c84c241/e4a3f/gh-tag.png 295w,\n/static/ea86315a74ee37b4084253357c84c241/fcda8/gh-tag.png 590w,\n/static/ea86315a74ee37b4084253357c84c241/efc66/gh-tag.png 885w,\n/static/ea86315a74ee37b4084253357c84c241/84bf8/gh-tag.png 1162w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b7206769cf0cf5061917d06278daf362/d74fe/gh-release.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.62162162162163%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB8klEQVQoz5VS227TQBDd30BCAkJSNyEl0AD9LN5QC2lNSZpEBJD4FT6ENyQQT41bXxJfYnvt2auXcdLS0sIDo6O1Z3bO7O6ZIb3dvd1ne51uz2p3G03rXqPV3OpsbXeb1qPWdrfRat9/aN25+8Bq77R7fQvTOo9bnSe9p8/7/RdkNJ0NRh/27cmro/HL/eFre3wynU3efxxNZpPZJwQm2MPxG/vdwcAe2MODw7eD4/Hh8Wh4MiVCqlIoyqsMdFRoylRVGaW1riqp6hUNV/xlXKDPhTQGEzBsSBAk3396q1XGOQMoKaUlMFoURQm0RIPapegBhjCCW0IILMGFIF+/BZ+/nDlOhPWw2H8ZgTAU3plgPM9pkqxWaSakUEpVV2YuPsZ4nj93nNO5E0ZxTY7mrvvjNEohzHmYMUSEyLlQt65RGT9YnLsuAsl4AKFZnqd5AXW21OY39N/eEMfxMlpbHEspCTBeAKAiKLtUV0D3BqRUeLLr+YvF0g8ClI0wxtfSqeu4zdzAX5uL1w5DVIHUVKX/wD+YuBUsE8dbuv4iThJdaQLA6pYW2FUogJVrXOdwhJAYAsaEMgh9qUZ9bXx2WeKE8JyWaZpneT0TGNmsFyWQz8Wl6mbTOTwZhKwHEUdPYAbjdTlgKD+s6yqlN9D6pv6/AJRj4a2ROeFkAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Do a release in GH\"\n        title=\"Do a release in GH\"\n        src=\"/static/b7206769cf0cf5061917d06278daf362/fcda8/gh-release.png\"\n        srcset=\"/static/b7206769cf0cf5061917d06278daf362/12f09/gh-release.png 148w,\n/static/b7206769cf0cf5061917d06278daf362/e4a3f/gh-release.png 295w,\n/static/b7206769cf0cf5061917d06278daf362/fcda8/gh-release.png 590w,\n/static/b7206769cf0cf5061917d06278daf362/efc66/gh-release.png 885w,\n/static/b7206769cf0cf5061917d06278daf362/d74fe/gh-release.png 1164w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>If you have done these steps correctly, Thoth will pick up your tag and run a image build for you.</p>\n<h2 id=\"checking-and-debugging-the-build\" style=\"position:relative;\"><a href=\"#checking-and-debugging-the-build\" aria-label=\"checking and debugging the build permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Checking and debugging the build</h2>\n<p>You can login to <a href=\"https://tekton-dashboard-openshift-pipelines.apps.ocp4.prod.psi.redhat.com/\">https://tekton-dashboard-openshift-pipelines.apps.ocp4.prod.psi.redhat.com/</a> and find your build by using the search field. Enter “project:&#x3C;YOUR<em>REPO</em>NAME>“.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ed3d625fec1d7e4acb5615b02f04b61f/19a6b/thoth-pipeline-run.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.51351351351351%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABxUlEQVQoz51Qy27TQBSdXwCkChw7FbRKQZHK9/AlQFs7kIgFG74EdjwES1ggEAIBKqUmcQjIdhKPxxPPM36Va3sDFSzK0dH1PaM5vmcu2treubLVMzoWsNOxTLNrWZvQGIZpdMxLhrmxcfHc+Qtda/Pq7vVe/5rVvWxY1nZvZ7ffR/cbDIfD0Wh0YA9u3t67tbe/bzv24I7t1HQGd4EgD2wHLkDj1P0ADpFSKs/zkwZZXkZUYaq4KkFWf7JF25dNRd/G3mQyjuOYJsnPxerT248fXr523x+GP5Yh5mHETjGI2DJmnDGSpEgIkWVZ+9dwjh8/ff7k2YuZj1N1AvOZKrmuuC4bViB1VgWkfPSmenVUojRlUsrWLFRGuWRc0oQuY7JYRjGh8wWGb4TJfIkx5CP43XFy48Hq3kOGZIPWnMTJ9OiL+/l49tXzve+H7swPo8l47Lpu4PtQwyCYet7Um1AcpjSuYxNCtFb1ZJkJJlPCKbxqJRJRrEQGcbhct2RCg4TKBMgM1auitF54Vcl1wVTBdSF0U1XOT7P4reYInDAZkq/XWuqc/cXwTyLGGOe8XTiY+ZnMvEFVVY25ONtkyAw7+z/zL3g1lcm3Z7IAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Tekton: search a build\"\n        title=\"Tekton: search a build\"\n        src=\"/static/ed3d625fec1d7e4acb5615b02f04b61f/fcda8/thoth-pipeline-run.png\"\n        srcset=\"/static/ed3d625fec1d7e4acb5615b02f04b61f/12f09/thoth-pipeline-run.png 148w,\n/static/ed3d625fec1d7e4acb5615b02f04b61f/e4a3f/thoth-pipeline-run.png 295w,\n/static/ed3d625fec1d7e4acb5615b02f04b61f/fcda8/thoth-pipeline-run.png 590w,\n/static/ed3d625fec1d7e4acb5615b02f04b61f/efc66/thoth-pipeline-run.png 885w,\n/static/ed3d625fec1d7e4acb5615b02f04b61f/c83ae/thoth-pipeline-run.png 1180w,\n/static/ed3d625fec1d7e4acb5615b02f04b61f/19a6b/thoth-pipeline-run.png 1191w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The part that is relevant for image building is under “tag-release-run”. There may by other sections that are red, but if this part is green the image was built and pushed. You can also check that on Quay.io.</p>\n<h1 id=\"adding-the-image-where-you-need-it\" style=\"position:relative;\"><a href=\"#adding-the-image-where-you-need-it\" aria-label=\"adding the image where you need it permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Adding the image where you need it</h1>\n<p>Once your image is built (check in Quay), you can use it in your instance of ODH.</p>\n<h2 id=\"creating-an-imagestream\" style=\"position:relative;\"><a href=\"#creating-an-imagestream\" aria-label=\"creating an imagestream permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating an ImageStream</h2>\n<p>This is done using a manifest of type <code class=\"language-text\">ImageStream</code>.</p>\n<p>Here is an example:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> image.openshift.io/v1\n  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ImageStream\n  <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> categorical<span class=\"token punctuation\">-</span>encoding<span class=\"token punctuation\">-</span>notebook\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">opendatahub.io/notebook-image</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"true\"</span>\n  <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">lookupPolicy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">local</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">from</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> DockerImage\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> quay.io/aicoe/categorical<span class=\"token punctuation\">-</span>encoding<span class=\"token punctuation\">:</span>latest\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> latest\n        <span class=\"token key atrule\">importPolicy</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">scheduled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<p>The important part is:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  labels:\n    opendatahub.io/notebook-image: &quot;true&quot;</code></pre></div>\n<p>This tells JupyterHub that it has to offer this particular image then creating an instance for it’s users.</p>\n<p>Depending on where you want to use your image, you have to place the manifest into the right place or load in into your project using <code class=\"language-text\">oc apply -f &lt;image_file.yaml&gt;</code>.</p>\n<p>For example</p>\n<ul class=\"pf-c-list\">\n<li>If you want to add your image to MOC, make a PR such as this one: <a href=\"https://github.com/operate-first/odh/pull/25\">https://github.com/operate-first/odh/pull/25</a></li>\n<li>If you need to add your image to the DH (ODH instance run by DH team), make a PR against the <code class=\"language-text\">production</code> branch here:\n<a href=\"https://github.com/AICoE/idh-manifests/blob/production/jupyterhub/bases/custom-images/jupyterhub-custom-images.yaml\">https://github.com/AICoE/idh-manifests/blob/production/jupyterhub/bases/custom-images/jupyterhub-custom-images.yaml</a></li>\n</ul>","fields":{"srcLink":"https://github.com/aicoe-aiops/data-science-workflows/blob/master/docs/create_and_deploy_jh_image.md"},"frontmatter":{"title":"","description":null}}},"pageContext":{"id":"3d40f6a8-292f-5266-a114-bc14e273b0a6"}},"staticQueryHashes":["117426894","3000541721"]}