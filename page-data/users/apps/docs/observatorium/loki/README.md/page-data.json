{"componentChunkName":"component---src-templates-markdown-js","path":"/users/apps/docs/observatorium/loki/README.md","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"markdownRemark":{"id":"926fe967-6409-5448-821d-4c437ead1877","html":"<h2 id=\"loki-access\" style=\"position:relative;\"><a href=\"#loki-access\" aria-label=\"loki access permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Loki Access</h2>\n<p><a href=\"https://github.com/grafana/loki#loki-like-prometheus-but-for-logs\">Loki</a> is a horizontally-scalable, highly-available, multi-tenant log aggregation system.</p>\n<p>An instance of Loki is available for use in OperateFirst.</p>\n<p>Loki access is open to public and is divided into 3 different components:</p>\n<ol class=\"pf-c-list\">\n<li>Loki Distributor</li>\n<li>Loki Frontend</li>\n<li>Grafana</li>\n</ol>\n<p>While pushing logs into Loki or while querying Loki for logs,\nyou will need to have a header <code class=\"language-text\">&#39;X-Scope-OrgID&#39;</code> set in your requests. <br>\nThis header (OrgID) is used to identify tenants in a multi tenancy setup (<a href=\"https://grafana.com/docs/loki/latest/operations/multi-tenancy/\">more info</a>),\nit will also play a role when adding a Loki Grafana datasource, more on that later.</p>\n<p>The value for this header can be anything. <br>\nFor our examples, we will set it to <code class=\"language-text\">&#39;X-Scope-OrgID: opf-example&#39;</code>.</p>\n<h3 id=\"loki-distributor\" style=\"position:relative;\"><a href=\"#loki-distributor\" aria-label=\"loki distributor permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Loki Distributor</h3>\n<ul class=\"pf-c-list\">\n<li>url: <a href=\"http://loki-distributor-opf-observatorium.apps.cnv.massopen.cloud/\">http://loki-distributor-opf-observatorium.apps.cnv.massopen.cloud/</a></li>\n</ul>\n<p>This is the endpoint that can be used to push logs into Loki. <br></p>\n<p>Example:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> -v -H <span class=\"token string\">\"Content-Type: application/json\"</span> <span class=\"token punctuation\">\\</span>\n  -H <span class=\"token string\">\"X-Scope-OrgID: opf-example\"</span> <span class=\"token punctuation\">\\</span>\n  -XPOST -s <span class=\"token string\">\"http://loki-distributor-opf-observatorium.apps.cnv.massopen.cloud/loki/api/v1/push\"</span> --data-raw <span class=\"token punctuation\">\\</span>\n  <span class=\"token string\">'{\"streams\": [{ \"stream\": { \"app\": \"my-app-1\" }, \"values\": [ [ \"1607526347000000000\", \"my-log-line\" ] ] }]}'</span></code></pre></div>\n<p>This command sends a log line <code class=\"language-text\">&quot;my-log-line&quot;</code> with the label <code class=\"language-text\">&quot;app&quot;: &quot;my-app-1&quot;</code> for the timestamp <code class=\"language-text\">1607526347000000000</code> (<code class=\"language-text\">2020-12-09T15:05:47.000Z</code>) and uses <code class=\"language-text\">&quot;opf-example&quot;</code> as the OrgID (or tenant ID).</p>\n<p>More Info on  <a href=\"https://grafana.com/docs/loki/latest/api/#post-lokiapiv1push\">/push</a></p>\n<h3 id=\"loki-frontend\" style=\"position:relative;\"><a href=\"#loki-frontend\" aria-label=\"loki frontend permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Loki Frontend</h3>\n<ul class=\"pf-c-list\">\n<li>url: <a href=\"http://loki-frontend-opf-observatorium.apps.cnv.massopen.cloud/\">http://loki-frontend-opf-observatorium.apps.cnv.massopen.cloud/</a></li>\n</ul>\n<p>This is the endpoint that can be used to query logs from Loki. <br></p>\n<p>Example:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> -H <span class=\"token string\">\"X-Scope-OrgID: opf-example\"</span> <span class=\"token punctuation\">\\</span>\n  -G -s  <span class=\"token string\">\"http://loki-frontend-opf-observatorium.apps.cnv.massopen.cloud/loki/api/v1/query_range\"</span> <span class=\"token punctuation\">\\</span>\n  --data-urlencode <span class=\"token string\">'query={app=\"my-app-1\"}'</span> <span class=\"token punctuation\">\\</span>\n  --data-urlencode <span class=\"token string\">'start=1607526347000000000'</span></code></pre></div>\n<p>This command queries logs from Loki using <code class=\"language-text\">&quot;app=&quot;my-app-1&quot;</code> label as the\nquery and the start time for the query is set to <code class=\"language-text\">1607526347000000000</code> (<code class=\"language-text\">2020-12-09T15:05:47.000Z</code>). <br>\n<em>Notice that we had to provide the same OrgID “opf-example” to be able to query for the logs that we pushed in.</em></p>\n<p>More Info on <a href=\"https://grafana.com/docs/loki/latest/api/#get-lokiapiv1query_range\">/query_range</a></p>\n<h3 id=\"grafana\" style=\"position:relative;\"><a href=\"#grafana\" aria-label=\"grafana permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Grafana</h3>\n<ul class=\"pf-c-list\">\n<li>url: <a href=\"https://grafana-route-opf-observatorium.apps.cnv.massopen.cloud/\">https://grafana-route-opf-observatorium.apps.cnv.massopen.cloud/</a></li>\n</ul>\n<p>This is the endpoint for Grafana that can be used to query logs from Loki in a UI.</p>\n<p>To be able to query logs using Grafana, you will need to add a Grafana Datasource\nspecific to your Org-ID (the <code class=\"language-text\">&#39;X-Scope-OrgID&#39;</code> header). To do that instructions are available <a href=\"./add_loki_grafana_datasource.md\">here</a>.</p>\n<p>An example query should be accessible at the following url: <br>\n<a href=\"https://grafana-route-opf-observatorium.apps.cnv.massopen.cloud/explore?orgId=1&#x26;left=%5B%221607519717000%22,%221607526347000%22,%22loki-opf-example%22,%7B%22expr%22:%22%7Bapp%3D%5C%22my-app-1%5C%22%7D%22%7D\">https://grafana-route-opf-observatorium.apps.cnv.massopen.cloud/explore?orgId=1&#x26;left=[“1607519717000”,“1607526347000”,“loki-opf-example”,{“expr”:“{app%3D\\“my-app-1\\”}“}</a>]</p>","fields":{"srcLink":"https://github.com/operate-first/apps/blob/master/docs/observatorium/loki/README.md"},"frontmatter":{"title":"","description":null}}},"pageContext":{"id":"926fe967-6409-5448-821d-4c437ead1877"}},"staticQueryHashes":["117426894","3000541721"]}