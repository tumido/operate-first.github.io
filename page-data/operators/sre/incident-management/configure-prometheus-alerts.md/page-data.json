{"componentChunkName":"component---src-templates-markdown-js","path":"/operators/sre/incident-management/configure-prometheus-alerts.md","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"markdownRemark":{"id":"9713ec0f-dfc9-56d3-9754-fe7ae7593e67","html":"<h1 id=\"configuring-prometheus-alerts\" style=\"position:relative;\"><a href=\"#configuring-prometheus-alerts\" aria-label=\"configuring prometheus alerts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configuring Prometheus Alerts</h1>\n<p>Our Prometheus instance can be reached at:  <a href=\"http://prometheus-portal-opf-monitoring.apps.cnv.massopen.cloud/graph\">http://prometheus-portal-opf-monitoring.apps.cnv.massopen.cloud/graph</a>.\nFollow the instructions described below for configuring alerts to our Prometheus instance.</p>\n<h2 id=\"adding-alerts\" style=\"position:relative;\"><a href=\"#adding-alerts\" aria-label=\"adding alerts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Adding Alerts</h2>\n<p>If you wish to add new alerts for your team/applications to our Prometheus instance, you will need to:</p>\n<ol class=\"pf-c-list\">\n<li>Define your Prometheus alerting rules in a <code class=\"language-text\">example-prometheus-rules.yaml</code> file in our <a href=\"https://github.com/operate-first/apps/\"><code class=\"language-text\">operate-first/apps</code></a> repo:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> monitoring.coreos.com/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PrometheusRule\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">prometheus</span><span class=\"token punctuation\">:</span> odh<span class=\"token punctuation\">-</span>monitoring\n    <span class=\"token key atrule\">role</span><span class=\"token punctuation\">:</span> alert<span class=\"token punctuation\">-</span>rules\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> example<span class=\"token punctuation\">-</span>prometheus<span class=\"token punctuation\">-</span>alerting<span class=\"token punctuation\">-</span>rules\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">groups</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Example Rules\n      <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">alert</span><span class=\"token punctuation\">:</span> ExampleAlert\n          <span class=\"token key atrule\">expr</span><span class=\"token punctuation\">:</span> vector(1)\n          <span class=\"token key atrule\">for</span><span class=\"token punctuation\">:</span> 2m\n          <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">summary</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"This is an example alert\"</span></code></pre></div>\n<p>Save this file under <code class=\"language-text\">odh/overlays/moc/monitoring/alerts/example-prometheus-rules.yaml</code>.</p>\n<ol start=\"3\" class=\"pf-c-list\">\n<li>Add your prometheus alerting rule file to <code class=\"language-text\">odh/overlays/moc/monitoring/alerts/kustomization.yaml</code> by running the following:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">cd</span> odh/overlays/moc/monitoring/alerts/\n$ kustomize edit <span class=\"token function\">add</span> resource example-prometheus-rules.yaml</code></pre></div>\n<ol start=\"4\" class=\"pf-c-list\">\n<li>Once you have the alerting rules defined, you will need to add your preferred alert receiver to which the alerts will be routed. The receiver can be Slack, Email, PagerDuty etc. We currently route our alerts to the <a href=\"https://github.com/m-lab/alertmanager-github-receiver\">GitHub receiver</a> which automatically creates issues in this repo for any alerts being fired. If you would like to try out the GitHub receiver, we would recommend you to have your own deployment so that you can configure it to create issues in your preferred repo(s) and customize it according to your needs. The deployment instructions can be found <a href=\"https://github.com/operate-first/SRE/blob/master/incident-management/github-receiver-setup.md\">here</a>.</li>\n<li>Once you have your alert receiver setup, you will need to add this receiver to our Prometheus alertmanager config <a href=\"https://github.com/operate-first/apps/blob/master/odh/base/monitoring/alertmanager-config.yaml\">here</a>:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">alertmanager.yaml</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n    routes:\n    - match_re:\n        # This matches all metrics having the `job` label beginning with the string `example`\n        job: ^(example).*$\n        receiver: your-receiver</span>\n\n    <span class=\"token key atrule\">receivers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'your-receiver'</span>\n      <span class=\"token key atrule\">webhook_configs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'your-receiver-address'</span></code></pre></div>\n<p>In order to differentiate and route the alerts to their respective receivers, you will need to provide a suitable regex expression matching your metrics so that the alerts for those metrics only get routed to your receiver. This is specified in the <code class=\"language-text\">match_re</code> field.</p>\n<p>Depending on your receiver type, you will add it under the <code class=\"language-text\">receivers</code> field with a suitable name. For more information on the various receivers supported by Prometheus and how they are defined, you can refer to the documentation <a href=\"https://prometheus.io/docs/alerting/latest/configuration/#receiver\">here</a>.</p>\n<ol start=\"6\" class=\"pf-c-list\">\n<li>Submit a PR with all the above changes to our <code class=\"language-text\">operate-first/apps</code> repo. Once it is successfully merged, you should be able to confirm and view your alerting rules here: <a href=\"http://prometheus-portal-opf-monitoring.apps.cnv.massopen.cloud/alerts!\">http://prometheus-portal-opf-monitoring.apps.cnv.massopen.cloud/alerts!</a></li>\n</ol>","fields":{"srcLink":"https://github.com/operate-first/SRE/blob/master/incident-management/configure-prometheus-alerts.md"},"frontmatter":{"title":"","description":null}}},"pageContext":{"id":"9713ec0f-dfc9-56d3-9754-fe7ae7593e67"}},"staticQueryHashes":["117426894","3000541721"]}