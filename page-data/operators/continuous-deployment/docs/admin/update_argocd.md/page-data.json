{"componentChunkName":"component---src-templates-markdown-js","path":"/operators/continuous-deployment/docs/admin/update_argocd.md","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"markdownRemark":{"id":"53995f29-3364-5788-910d-0c28dfc18d94","html":"<h1 id=\"steps-for-upgrading-argocd\" style=\"position:relative;\"><a href=\"#steps-for-upgrading-argocd\" aria-label=\"steps for upgrading argocd permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Steps for Upgrading ArgoCD</h1>\n<p>Here’s a list of relevant release pages you might find useful:</p>\n<ul class=\"pf-c-list\">\n<li>ArgoCD releases: <a href=\"https://github.com/argoproj/argo-cd/releases\">link</a></li>\n<li>KSOPS releases: <a href=\"https://github.com/viaduct-ai/kustomize-sops/releases\">link</a></li>\n<li>Kustomize releases: <a href=\"https://github.com/kubernetes-sigs/kustomize/releases\">link</a></li>\n<li>SOPS releases: <a href=\"https://github.com/mozilla/sops/releases\">link</a></li>\n<li>Helm-Sercrets releases: <a href=\"https://github.com/zendesk/helm-secrets/releases\">link</a></li>\n</ul>\n<p>First checkout the upgrade docs <a href=\"https://argoproj.github.io/argo-cd/operator-manual/upgrading/overview/\">here</a> to see if there have been any major/breaking changes, or additional steps that will be required when updating between versions.</p>\n<h1 id=\"determine-version-number\" style=\"position:relative;\"><a href=\"#determine-version-number\" aria-label=\"determine version number permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Determine version Number</h1>\n<p>The version number will be referred throughout this doc, it takes the form of <code class=\"language-text\">X.X.X-Y</code>. Where <code class=\"language-text\">X.X.X</code> refers to the ArgoCD version number, and the <code class=\"language-text\">-Y</code> suffix, refers to our custom version that iterates on the <code class=\"language-text\">X.X.X</code> ArgoCD version. The <code class=\"language-text\">-Y</code> value indicates the version number for our custom tooling. If we are simply updating the custom tooling, then we only bump <code class=\"language-text\">-Y</code> value. For example if we are updating our custom tooling for <code class=\"language-text\">1.7.8-1</code> but keeping ArgoCD at <code class=\"language-text\">1.7.8</code> then we would bump the version to <code class=\"language-text\">1.7.8-2</code>.</p>\n<p>We’ll use <code class=\"language-text\">X.X.X-Y</code> as the placeholder for this value throughout the doc.</p>\n<h1 id=\"update-custom-argocd-image\" style=\"position:relative;\"><a href=\"#update-custom-argocd-image\" aria-label=\"update custom argocd image permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Update custom ArgoCD image</h1>\n<p>Bump the <code class=\"language-text\">ARGO_CD_VERSION</code> to the new ArgoCD Version. If upgrading <code class=\"language-text\">KSOPS</code> then also bump <code class=\"language-text\">KSOPS_VERSION</code> to the newer version. Similarly change <code class=\"language-text\">SOPS_VERSION</code> and <code class=\"language-text\">HELM_SECRETS_VERSION</code> if needed.</p>\n<p>We don’t need to build/push this image, this will happen automatically when we create a tag release at the end.</p>\n<h1 id=\"updating-redis-image\" style=\"position:relative;\"><a href=\"#updating-redis-image\" aria-label=\"updating redis image permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Updating Redis image</h1>\n<p>Upstream uses <code class=\"language-text\">redis</code> on docker for their image, we prefer to use <code class=\"language-text\">quay</code> so we don’t encounter rate-limit issues. Unfortunately this means we need to also push a new <code class=\"language-text\">redis</code> image to our <code class=\"language-text\">quay</code> org whenever newer <code class=\"language-text\">redis</code> is introduced in <code class=\"language-text\">ArgoCD</code>.</p>\n<p>Check <a href=\"https://github.com/argoproj/argo-cd/blob/master/manifests/install.yaml\">here</a>, under the tag appropriate ArgoCD version tag. Search for the <code class=\"language-text\">redis</code> deployment and see if the tag version for <code class=\"language-text\">redis</code> under <code class=\"language-text\">containers/0/image</code> has been updated. If it has, then push this new image onto <code class=\"language-text\">quay.io/operate-first/redis</code>. For example, if adding <code class=\"language-text\">redis:5.0.10-alpine</code> we would do the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ podman pull redis:5.0.10-alpine\n$ podman push redis:5.0.10-alpine quay.io/operate-first/redis:5.0.10-alpine</code></pre></div>\n<p>Next, under the <code class=\"language-text\">images</code> section <a href=\"https://github.com/operate-first/continuous-deployment/blob/master/manifests/base/kustomization.yaml\">here</a> update the <code class=\"language-text\">newTag</code> field for the <code class=\"language-text\">redis</code> image accordingly. Folowing from our example above, we would have the following new image in our <code class=\"language-text\">Kustomization</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis\n    <span class=\"token key atrule\">newName</span><span class=\"token punctuation\">:</span> quay.io/operate<span class=\"token punctuation\">-</span>first/redis\n    <span class=\"token key atrule\">newTag</span><span class=\"token punctuation\">:</span> 5.0.10<span class=\"token punctuation\">-</span>alpine</code></pre></div>\n<h1 id=\"update-remote-kustomize-urls\" style=\"position:relative;\"><a href=\"#update-remote-kustomize-urls\" aria-label=\"update remote kustomize urls permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Update remote Kustomize URLs</h1>\n<p>If updating ArgoCD’s version, bump the remote image references in the following remote references:</p>\n<ul class=\"pf-c-list\">\n<li>ArgoCD namespace manifests <a href=\"https://github.com/operate-first/continuous-deployment/blob/master/manifests/base/kustomization.yaml#L4\">here</a></li>\n<li>ArgoCD cluster rbac <a href=\"https://github.com/operate-first/continuous-deployment/blob/master/manifests/crds/kustomization.yaml#L5\">here</a></li>\n</ul>\n<p>Do a search for other references to <code class=\"language-text\">github.com/argoproj/argo-cd</code> remote references and update accordingly where applicable.</p>\n<h1 id=\"update-container-images\" style=\"position:relative;\"><a href=\"#update-container-images\" aria-label=\"update container images permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Update Container Images</h1>\n<p>Under the <code class=\"language-text\">images</code> section <a href=\"https://github.com/operate-first/continuous-deployment/blob/master/manifests/base/kustomization.yaml\">here</a>, update the <code class=\"language-text\">operate-first/argocd</code> tag to <code class=\"language-text\">vX.X.X-Y</code>. For example, if updating to <code class=\"language-text\">v1.8.1-2</code> we would have the following new image in our <code class=\"language-text\">Kustomization</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> argoproj/argocd\n    <span class=\"token key atrule\">newName</span><span class=\"token punctuation\">:</span> quay.io/operate<span class=\"token punctuation\">-</span>first/argocd\n    <span class=\"token key atrule\">newTag</span><span class=\"token punctuation\">:</span> v1.8.1<span class=\"token punctuation\">-</span><span class=\"token number\">2</span></code></pre></div>\n<h1 id=\"update-toolbox\" style=\"position:relative;\"><a href=\"#update-toolbox\" aria-label=\"update toolbox permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Update toolbox</h1>\n<p>If updating any of the custom tooling (e.g. sops, ksops, helm, helm-secrets, etc.), these changes should also be brought to <code class=\"language-text\">operate-first/toolbox</code>, simply update the Dockerfile <a href=\"https://github.com/operate-first/toolbox/blob/master/Dockerfile\">here</a>, you will likely only need to update the version variables.</p>\n<p>Update the version in the readme (to the version we’ll be tagging), and cut a new tag so that a new tag-release build is initiated.</p>\n<h1 id=\"update-docs\" style=\"position:relative;\"><a href=\"#update-docs\" aria-label=\"update docs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Update Docs</h1>\n<p>We make an attempt to list the current versions of our tooling <a href=\"https://github.com/operate-first/continuous-deployment/blob/master/docs/publish/versions.md\">here</a>. So update these accordingly.</p>\n<h1 id=\"create-a-release\" style=\"position:relative;\"><a href=\"#create-a-release\" aria-label=\"create a release permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create a release</h1>\n<p>Create a new tag in the form of <code class=\"language-text\">vX.X.X-Y</code>, where <code class=\"language-text\">X.X.X-Y</code> should resolve to the version number as described <a href=\"#determine-version-number\">here</a>. This tag will be used by downstream, and should never be changed once it’s created.</p>\n<p>Once the tag is created, a bot will create the build and publish it to <a href=\"https://quay.io/operate-first/argocd\">https://quay.io/operate-first/argocd</a>.</p>","fields":{"srcLink":"https://github.com/operate-first/continuous-deployment/blob/master/docs/admin/update_argocd.md"},"frontmatter":{"title":"","description":null}}},"pageContext":{"id":"53995f29-3364-5788-910d-0c28dfc18d94"}},"staticQueryHashes":["117426894","3000541721"]}